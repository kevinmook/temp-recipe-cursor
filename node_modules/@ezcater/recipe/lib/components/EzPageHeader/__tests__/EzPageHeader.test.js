"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

var _regenerator = _interopRequireDefault(require("@babel/runtime/regenerator"));

var _asyncToGenerator2 = _interopRequireDefault(require("@babel/runtime/helpers/asyncToGenerator"));

var _slicedToArray2 = _interopRequireDefault(require("@babel/runtime/helpers/slicedToArray"));

var _react = _interopRequireDefault(require("react"));

var _jestAxe = require("jest-axe");

var _sosia = require("sosia");

var _reactRouterDom = require("react-router-dom");

var _react2 = require("@testing-library/react");

var _EzPageHeader = _interopRequireDefault(require("../EzPageHeader.md"));

var _EzPageHeader2 = _interopRequireDefault(require("../EzPageHeader"));

var _index = require("../../index");

var _jestGlobals = require("../../../jest-globals");

afterEach(_react2.cleanup);

var mockRequire = function mockRequire() {
  return {
    Link: _reactRouterDom.Link,
    BrowserRouter: function BrowserRouter(_ref) {
      var children = _ref.children;
      return _react["default"].createElement(_reactRouterDom.StaticRouter, {
        context: {},
        location: "/components/ez-page-header/"
      }, children);
    },
    Route: _reactRouterDom.Route
  };
};

var scope = {
  EzPageHeader: _EzPageHeader2["default"],
  EzStatus: _index.EzStatus,
  EzButton: _index.EzButton,
  EzCard: _index.EzCard,
  EzLayout: _index.EzLayout,
  EzPage: _index.EzPage,
  require: mockRequire
};
describe('EzPageHeader', function () {
  (0, _sosia.visualSnapshots)({
    markdown: _EzPageHeader["default"],
    scope: scope
  });
  it('should cycle through the tabs', function () {
    var tabs = [{
      label: 'All'
    }, {
      label: 'Accepted'
    }, {
      label: 'Draft'
    }];
    var onChange = jest.fn();

    var _fullRender = (0, _jestGlobals.fullRender)(_react["default"].createElement(function () {
      var _React$useState = _react["default"].useState(tabs[1]),
          _React$useState2 = (0, _slicedToArray2["default"])(_React$useState, 2),
          selected = _React$useState2[0],
          setSelected = _React$useState2[1];

      onChange.mockImplementation(setSelected);
      return _react["default"].createElement(_EzPageHeader2["default"], {
        title: "Order # XYZ-123",
        subnav: {
          tabs: tabs,
          selected: selected,
          onChange: onChange
        }
      });
    })),
        getByText = _fullRender.getByText;

    var allTab = getByText('Accepted'); // test arrow left selects previous tab

    _react2.fireEvent.keyDown(allTab, {
      key: 'ArrowLeft',
      code: 27
    });

    expect(onChange).toHaveBeenLastCalledWith(tabs[0]);
    onChange.mockClear(); // test arrow left cycles back to last tab in the list

    _react2.fireEvent.keyDown(allTab, {
      key: 'ArrowLeft',
      code: 27
    });

    expect(onChange).toHaveBeenLastCalledWith(tabs[2]); // test arrow up also selects previous tab

    _react2.fireEvent.keyDown(allTab, {
      key: 'ArrowUp',
      code: 24
    });

    expect(onChange).toHaveBeenLastCalledWith(tabs[1]); // test arrow right selects next tab

    _react2.fireEvent.keyDown(allTab, {
      key: 'ArrowRight',
      code: 26
    });

    expect(onChange).toHaveBeenLastCalledWith(tabs[2]); // test arrow right cycles back to first tab in the list

    _react2.fireEvent.keyDown(allTab, {
      key: 'ArrowRight',
      code: 26
    });

    expect(onChange).toHaveBeenLastCalledWith(tabs[0]); // test arrow down also selects next tab

    _react2.fireEvent.keyDown(allTab, {
      key: 'ArrowDown',
      code: 25
    });

    expect(onChange).toHaveBeenLastCalledWith(tabs[1]); // test that other key presses don't change the current tab

    onChange.mockClear();

    _react2.fireEvent.keyDown(allTab, {
      key: 'Enter',
      code: 13
    });

    expect(onChange).not.toHaveBeenCalled();
  });
  it('should cycle from the focused tab to the next tab if no tab is currently selected', function () {
    var tabs = [{
      label: 'All'
    }, {
      label: 'Accepted'
    }, {
      label: 'Draft'
    }];
    var onChange = jest.fn();

    var _fullRender2 = (0, _jestGlobals.fullRender)(_react["default"].createElement(function () {
      var _React$useState3 = _react["default"].useState(null),
          _React$useState4 = (0, _slicedToArray2["default"])(_React$useState3, 2),
          selected = _React$useState4[0],
          setSelected = _React$useState4[1];

      onChange.mockImplementation(setSelected);
      return _react["default"].createElement(_EzPageHeader2["default"], {
        title: "Order # XYZ-123",
        subnav: {
          tabs: tabs,
          selected: selected,
          onChange: onChange
        }
      });
    })),
        getByText = _fullRender2.getByText;

    var allTab = getByText('All');
    allTab.focus();

    _react2.fireEvent.keyDown(allTab, {
      key: 'ArrowRight',
      code: 26
    });

    expect(onChange).toHaveBeenLastCalledWith(tabs[1]);
  });
  it('should meet accessibility guidelines',
  /*#__PURE__*/
  (0, _asyncToGenerator2["default"])(
  /*#__PURE__*/
  _regenerator["default"].mark(function _callee() {
    var tabs, wrapper, actual;
    return _regenerator["default"].wrap(function _callee$(_context) {
      while (1) {
        switch (_context.prev = _context.next) {
          case 0:
            tabs = [{
              label: 'All'
            }, {
              label: 'Accepted'
            }, {
              label: 'Draft'
            }];
            wrapper = (0, _jestGlobals.renderToHtml)(_react["default"].createElement(_EzPageHeader2["default"], {
              title: "Order # XYZ-123",
              breadcrumb: {
                label: 'Back to Orders',
                onClick: function onClick() {}
              },
              status: _react["default"].createElement(_index.EzStatus, {
                text: "Verified",
                use: "success"
              }),
              subnav: {
                tabs: tabs,
                selected: tabs[0],
                onChange: function onChange() {}
              },
              actions: _react["default"].createElement(_index.EzButton, {
                use: "primary"
              }, "Accept Order")
            }));
            _context.next = 4;
            return (0, _jestAxe.axe)(wrapper);

          case 4:
            actual = _context.sent;
            expect(actual).toHaveNoViolations();

          case 6:
          case "end":
            return _context.stop();
        }
      }
    }, _callee);
  })));
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL3NyYy9jb21wb25lbnRzL0V6UGFnZUhlYWRlci9fX3Rlc3RzX18vRXpQYWdlSGVhZGVyLnRlc3QudHN4Il0sIm5hbWVzIjpbImFmdGVyRWFjaCIsImNsZWFudXAiLCJtb2NrUmVxdWlyZSIsIkxpbmsiLCJCcm93c2VyUm91dGVyIiwiY2hpbGRyZW4iLCJSb3V0ZSIsInNjb3BlIiwiRXpQYWdlSGVhZGVyIiwiRXpTdGF0dXMiLCJFekJ1dHRvbiIsIkV6Q2FyZCIsIkV6TGF5b3V0IiwiRXpQYWdlIiwicmVxdWlyZSIsImRlc2NyaWJlIiwibWFya2Rvd24iLCJpdCIsInRhYnMiLCJsYWJlbCIsIm9uQ2hhbmdlIiwiamVzdCIsImZuIiwiUmVhY3QiLCJjcmVhdGVFbGVtZW50IiwidXNlU3RhdGUiLCJzZWxlY3RlZCIsInNldFNlbGVjdGVkIiwibW9ja0ltcGxlbWVudGF0aW9uIiwiZ2V0QnlUZXh0IiwiYWxsVGFiIiwiZmlyZUV2ZW50Iiwia2V5RG93biIsImtleSIsImNvZGUiLCJleHBlY3QiLCJ0b0hhdmVCZWVuTGFzdENhbGxlZFdpdGgiLCJtb2NrQ2xlYXIiLCJub3QiLCJ0b0hhdmVCZWVuQ2FsbGVkIiwiZm9jdXMiLCJ3cmFwcGVyIiwib25DbGljayIsImFjdHVhbCIsInRvSGF2ZU5vVmlvbGF0aW9ucyJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7OztBQUFBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUVBQSxTQUFTLENBQUNDLGVBQUQsQ0FBVDs7QUFFQSxJQUFNQyxXQUFXLEdBQUcsU0FBZEEsV0FBYztBQUFBLFNBQU87QUFDekJDLElBQUFBLElBQUksRUFBSkEsb0JBRHlCO0FBRXpCQyxJQUFBQSxhQUFhLEVBQUU7QUFBQSxVQUFFQyxRQUFGLFFBQUVBLFFBQUY7QUFBQSxhQUNiLGdDQUFDLDRCQUFEO0FBQWMsUUFBQSxPQUFPLEVBQUUsRUFBdkI7QUFBMkIsUUFBQSxRQUFRLEVBQUM7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NEI7QUFFbkNzQixZQUFBQSxPQUZtQyxHQUV6QiwrQkFDZCxnQ0FBQyx5QkFBRDtBQUNFLGNBQUEsS0FBSyxFQUFDLGlCQURSO0FBRUUsY0FBQSxVQUFVLEVBQUU7QUFDVnRCLGdCQUFBQSxLQUFLLEVBQUUsZ0JBREc7QUFFVnVCLGdCQUFBQSxPQUFPLEVBQUUsbUJBQU0sQ0FBRTtBQUZQLGVBRmQ7QUFNRSxjQUFBLE1BQU0sRUFBRSxnQ0FBQyxlQUFEO0FBQVUsZ0JBQUEsSUFBSSxFQUFDLFVBQWY7QUFBMEIsZ0JBQUEsR0FBRyxFQUFDO0FBQTlCLGdCQU5WO0FBT0UsY0FBQSxNQUFNLEVBQUU7QUFBQ3hCLGdCQUFBQSxJQUFJLEVBQUpBLElBQUQ7QUFBT1EsZ0JBQUFBLFFBQVEsRUFBRVIsSUFBSSxDQUFDLENBQUQsQ0FBckI7QUFBMEJFLGdCQUFBQSxRQUFRLEVBQUUsb0JBQU0sQ0FBRTtBQUE1QyxlQVBWO0FBUUUsY0FBQSxPQUFPLEVBQUUsZ0NBQUMsZUFBRDtBQUFVLGdCQUFBLEdBQUcsRUFBQztBQUFkO0FBUlgsY0FEYyxDQUZ5QjtBQUFBO0FBQUEsbUJBY3BCLGtCQUFJcUIsT0FBSixDQWRvQjs7QUFBQTtBQWNuQ0UsWUFBQUEsTUFkbUM7QUFlekNSLFlBQUFBLE1BQU0sQ0FBQ1EsTUFBRCxDQUFOLENBQWVDLGtCQUFmOztBQWZ5QztBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUE7QUFBQSxHQUF6QyxHQUFGO0FBaUJELENBL0ZPLENBQVIiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgUmVhY3QgZnJvbSAncmVhY3QnO1xuaW1wb3J0IHtheGV9IGZyb20gJ2plc3QtYXhlJztcbmltcG9ydCB7dmlzdWFsU25hcHNob3RzfSBmcm9tICdzb3NpYSc7XG5pbXBvcnQge0xpbmssIFN0YXRpY1JvdXRlciwgUm91dGV9IGZyb20gJ3JlYWN0LXJvdXRlci1kb20nO1xuaW1wb3J0IHtmaXJlRXZlbnQsIGNsZWFudXB9IGZyb20gJ0B0ZXN0aW5nLWxpYnJhcnkvcmVhY3QnO1xuaW1wb3J0IG1hcmtkb3duIGZyb20gJy4uL0V6UGFnZUhlYWRlci5tZCc7XG5pbXBvcnQgRXpQYWdlSGVhZGVyIGZyb20gJy4uL0V6UGFnZUhlYWRlcic7XG5pbXBvcnQge0V6U3RhdHVzLCBFekJ1dHRvbiwgRXpDYXJkLCBFekxheW91dCwgRXpQYWdlfSBmcm9tICcuLi8uLi9pbmRleCc7XG5pbXBvcnQge2Z1bGxSZW5kZXIsIHJlbmRlclRvSHRtbH0gZnJvbSAnLi4vLi4vLi4vamVzdC1nbG9iYWxzJztcblxuYWZ0ZXJFYWNoKGNsZWFudXApO1xuXG5jb25zdCBtb2NrUmVxdWlyZSA9ICgpID0+ICh7XG4gIExpbmssXG4gIEJyb3dzZXJSb3V0ZXI6ICh7Y2hpbGRyZW59KSA9PiAoXG4gICAgPFN0YXRpY1JvdXRlciBjb250ZXh0PXt7fX0gbG9jYXRpb249XCIvY29tcG9uZW50cy9lei1wYWdlLWhlYWRlci9cIj5cbiAgICAgIHtjaGlsZHJlbn1cbiAgICA8L1N0YXRpY1JvdXRlcj5cbiAgKSxcbiAgUm91dGUsXG59KTtcblxuY29uc3Qgc2NvcGUgPSB7RXpQYWdlSGVhZGVyLCBFelN0YXR1cywgRXpCdXR0b24sIEV6Q2FyZCwgRXpMYXlvdXQsIEV6UGFnZSwgcmVxdWlyZTogbW9ja1JlcXVpcmV9O1xuXG5kZXNjcmliZSgnRXpQYWdlSGVhZGVyJywgKCkgPT4ge1xuICB2aXN1YWxTbmFwc2hvdHMoe21hcmtkb3duLCBzY29wZX0pO1xuXG4gIGl0KCdzaG91bGQgY3ljbGUgdGhyb3VnaCB0aGUgdGFicycsICgpID0+IHtcbiAgICBjb25zdCB0YWJzID0gW3tsYWJlbDogJ0FsbCd9LCB7bGFiZWw6ICdBY2NlcHRlZCd9LCB7bGFiZWw6ICdEcmFmdCd9XTtcbiAgICBjb25zdCBvbkNoYW5nZSA9IGplc3QuZm4oKTtcblxuICAgIGNvbnN0IHtnZXRCeVRleHR9ID0gZnVsbFJlbmRlcihcbiAgICAgIFJlYWN0LmNyZWF0ZUVsZW1lbnQoKCkgPT4ge1xuICAgICAgICBjb25zdCBbc2VsZWN0ZWQsIHNldFNlbGVjdGVkXSA9IFJlYWN0LnVzZVN0YXRlKHRhYnNbMV0pO1xuICAgICAgICBvbkNoYW5nZS5tb2NrSW1wbGVtZW50YXRpb24oc2V0U2VsZWN0ZWQpO1xuICAgICAgICByZXR1cm4gPEV6UGFnZUhlYWRlciB0aXRsZT1cIk9yZGVyICMgWFlaLTEyM1wiIHN1Ym5hdj17e3RhYnMsIHNlbGVjdGVkLCBvbkNoYW5nZX19IC8+O1xuICAgICAgfSlcbiAgICApO1xuXG4gICAgY29uc3QgYWxsVGFiID0gZ2V0QnlUZXh0KCdBY2NlcHRlZCcpO1xuXG4gICAgLy8gdGVzdCBhcnJvdyBsZWZ0IHNlbGVjdHMgcHJldmlvdXMgdGFiXG4gICAgZmlyZUV2ZW50LmtleURvd24oYWxsVGFiLCB7a2V5OiAnQXJyb3dMZWZ0JywgY29kZTogMjd9KTtcblxuICAgIGV4cGVjdChvbkNoYW5nZSkudG9IYXZlQmVlbkxhc3RDYWxsZWRXaXRoKHRhYnNbMF0pO1xuXG4gICAgb25DaGFuZ2UubW9ja0NsZWFyKCk7XG5cbiAgICAvLyB0ZXN0IGFycm93IGxlZnQgY3ljbGVzIGJhY2sgdG8gbGFzdCB0YWIgaW4gdGhlIGxpc3RcbiAgICBmaXJlRXZlbnQua2V5RG93bihhbGxUYWIsIHtrZXk6ICdBcnJvd0xlZnQnLCBjb2RlOiAyN30pO1xuXG4gICAgZXhwZWN0KG9uQ2hhbmdlKS50b0hhdmVCZWVuTGFzdENhbGxlZFdpdGgodGFic1syXSk7XG5cbiAgICAvLyB0ZXN0IGFycm93IHVwIGFsc28gc2VsZWN0cyBwcmV2aW91cyB0YWJcbiAgICBmaXJlRXZlbnQua2V5RG93bihhbGxUYWIsIHtrZXk6ICdBcnJvd1VwJywgY29kZTogMjR9KTtcblxuICAgIGV4cGVjdChvbkNoYW5nZSkudG9IYXZlQmVlbkxhc3RDYWxsZWRXaXRoKHRhYnNbMV0pO1xuXG4gICAgLy8gdGVzdCBhcnJvdyByaWdodCBzZWxlY3RzIG5leHQgdGFiXG4gICAgZmlyZUV2ZW50LmtleURvd24oYWxsVGFiLCB7a2V5OiAnQXJyb3dSaWdodCcsIGNvZGU6IDI2fSk7XG5cbiAgICBleHBlY3Qob25DaGFuZ2UpLnRvSGF2ZUJlZW5MYXN0Q2FsbGVkV2l0aCh0YWJzWzJdKTtcblxuICAgIC8vIHRlc3QgYXJyb3cgcmlnaHQgY3ljbGVzIGJhY2sgdG8gZmlyc3QgdGFiIGluIHRoZSBsaXN0XG4gICAgZmlyZUV2ZW50LmtleURvd24oYWxsVGFiLCB7a2V5OiAnQXJyb3dSaWdodCcsIGNvZGU6IDI2fSk7XG5cbiAgICBleHBlY3Qob25DaGFuZ2UpLnRvSGF2ZUJlZW5MYXN0Q2FsbGVkV2l0aCh0YWJzWzBdKTtcblxuICAgIC8vIHRlc3QgYXJyb3cgZG93biBhbHNvIHNlbGVjdHMgbmV4dCB0YWJcbiAgICBmaXJlRXZlbnQua2V5RG93bihhbGxUYWIsIHtrZXk6ICdBcnJvd0Rvd24nLCBjb2RlOiAyNX0pO1xuXG4gICAgZXhwZWN0KG9uQ2hhbmdlKS50b0hhdmVCZWVuTGFzdENhbGxlZFdpdGgodGFic1sxXSk7XG5cbiAgICAvLyB0ZXN0IHRoYXQgb3RoZXIga2V5IHByZXNzZXMgZG9uJ3QgY2hhbmdlIHRoZSBjdXJyZW50IHRhYlxuICAgIG9uQ2hhbmdlLm1vY2tDbGVhcigpO1xuXG4gICAgZmlyZUV2ZW50LmtleURvd24oYWxsVGFiLCB7a2V5OiAnRW50ZXInLCBjb2RlOiAxM30pO1xuXG4gICAgZXhwZWN0KG9uQ2hhbmdlKS5ub3QudG9IYXZlQmVlbkNhbGxlZCgpO1xuICB9KTtcblxuICBpdCgnc2hvdWxkIGN5Y2xlIGZyb20gdGhlIGZvY3VzZWQgdGFiIHRvIHRoZSBuZXh0IHRhYiBpZiBubyB0YWIgaXMgY3VycmVudGx5IHNlbGVjdGVkJywgKCkgPT4ge1xuICAgIGNvbnN0IHRhYnMgPSBbe2xhYmVsOiAnQWxsJ30sIHtsYWJlbDogJ0FjY2VwdGVkJ30sIHtsYWJlbDogJ0RyYWZ0J31dO1xuICAgIGNvbnN0IG9uQ2hhbmdlID0gamVzdC5mbigpO1xuXG4gICAgY29uc3Qge2dldEJ5VGV4dH0gPSBmdWxsUmVuZGVyKFxuICAgICAgUmVhY3QuY3JlYXRlRWxlbWVudCgoKSA9PiB7XG4gICAgICAgIGNvbnN0IFtzZWxlY3RlZCwgc2V0U2VsZWN0ZWRdID0gUmVhY3QudXNlU3RhdGUobnVsbCk7XG4gICAgICAgIG9uQ2hhbmdlLm1vY2tJbXBsZW1lbnRhdGlvbihzZXRTZWxlY3RlZCk7XG4gICAgICAgIHJldHVybiA8RXpQYWdlSGVhZGVyIHRpdGxlPVwiT3JkZXIgIyBYWVotMTIzXCIgc3VibmF2PXt7dGFicywgc2VsZWN0ZWQsIG9uQ2hhbmdlfX0gLz47XG4gICAgICB9KVxuICAgICk7XG5cbiAgICBjb25zdCBhbGxUYWIgPSBnZXRCeVRleHQoJ0FsbCcpO1xuXG4gICAgYWxsVGFiLmZvY3VzKCk7XG5cbiAgICBmaXJlRXZlbnQua2V5RG93bihhbGxUYWIsIHtrZXk6ICdBcnJvd1JpZ2h0JywgY29kZTogMjZ9KTtcblxuICAgIGV4cGVjdChvbkNoYW5nZSkudG9IYXZlQmVlbkxhc3RDYWxsZWRXaXRoKHRhYnNbMV0pO1xuICB9KTtcblxuICBpdCgnc2hvdWxkIG1lZXQgYWNjZXNzaWJpbGl0eSBndWlkZWxpbmVzJywgYXN5bmMgKCkgPT4ge1xuICAgIGNvbnN0IHRhYnMgPSBbe2xhYmVsOiAnQWxsJ30sIHtsYWJlbDogJ0FjY2VwdGVkJ30sIHtsYWJlbDogJ0RyYWZ0J31dO1xuICAgIGNvbnN0IHdyYXBwZXIgPSByZW5kZXJUb0h0bWwoXG4gICAgICA8RXpQYWdlSGVhZGVyXG4gICAgICAgIHRpdGxlPVwiT3JkZXIgIyBYWVotMTIzXCJcbiAgICAgICAgYnJlYWRjcnVtYj17e1xuICAgICAgICAgIGxhYmVsOiAnQmFjayB0byBPcmRlcnMnLFxuICAgICAgICAgIG9uQ2xpY2s6ICgpID0+IHt9LFxuICAgICAgICB9fVxuICAgICAgICBzdGF0dXM9ezxFelN0YXR1cyB0ZXh0PVwiVmVyaWZpZWRcIiB1c2U9XCJzdWNjZXNzXCIgLz59XG4gICAgICAgIHN1Ym5hdj17e3RhYnMsIHNlbGVjdGVkOiB0YWJzWzBdLCBvbkNoYW5nZTogKCkgPT4ge319fVxuICAgICAgICBhY3Rpb25zPXs8RXpCdXR0b24gdXNlPVwicHJpbWFyeVwiPkFjY2VwdCBPcmRlcjwvRXpCdXR0b24+fVxuICAgICAgLz5cbiAgICApO1xuICAgIGNvbnN0IGFjdHVhbCA9IGF3YWl0IGF4ZSh3cmFwcGVyKTtcbiAgICBleHBlY3QoYWN0dWFsKS50b0hhdmVOb1Zpb2xhdGlvbnMoKTtcbiAgfSk7XG59KTtcbiJdfQ==