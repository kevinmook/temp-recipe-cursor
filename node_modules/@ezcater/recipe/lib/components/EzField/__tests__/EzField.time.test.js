"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

var _extends2 = _interopRequireDefault(require("@babel/runtime/helpers/extends"));

var _slicedToArray2 = _interopRequireDefault(require("@babel/runtime/helpers/slicedToArray"));

var _regenerator = _interopRequireDefault(require("@babel/runtime/regenerator"));

var _asyncToGenerator2 = _interopRequireDefault(require("@babel/runtime/helpers/asyncToGenerator"));

var _react = _interopRequireDefault(require("react"));

var _sosia = require("sosia");

var _react2 = require("@testing-library/react");

var _EzTimeInputTest = _interopRequireDefault(require("./EzTimeInput.test.md"));

require("../mocks");

var _EzField = _interopRequireDefault(require("../EzField"));

var _jestGlobals = require("../../../jest-globals");

var _index = require("../../index");

var _Open = _interopRequireDefault(require("../Open"));

var _Media = _interopRequireDefault(require("../Media"));

var scope = {
  EzField: _EzField["default"],
  EzFormLayout: _index.EzFormLayout,
  Open: _Open["default"],
  Media: _Media["default"]
};
describe('EzField', function () {
  var label = 'Select time';
  (0, _sosia.visualSnapshots)({
    markdown: _EzTimeInputTest["default"],
    scope: scope
  });
  it('should generate the correct time range options', function () {
    var _render = (0, _jestGlobals.fullRender)(_react["default"].createElement(_EzField["default"], {
      type: "time",
      label: label,
      start: "9:00 am",
      end: "5:00 pm",
      step: 60
    })),
        container = _render.container;

    typeArrowDownToOpenSelectList(container);
    var options = (0, _react2.getAllByRole)(container, 'option');
    expectHourlyOptionsFrom9to5(options);
  });
  it('start and end time props can omit space between the time and the meridiem', function () {
    var _render2 = (0, _jestGlobals.fullRender)(_react["default"].createElement(_EzField["default"], {
      type: "time",
      label: label,
      start: "9:00am",
      end: "5:00pm",
      step: 60
    })),
        container = _render2.container;

    typeArrowDownToOpenSelectList(container);
    var options = (0, _react2.getAllByRole)(container, 'option');
    expectHourlyOptionsFrom9to5(options);
  });
  it('start and end time props are case insensitive', function () {
    var _render3 = (0, _jestGlobals.fullRender)(_react["default"].createElement(_EzField["default"], {
      type: "time",
      label: label,
      start: "9:00AM",
      end: "5:00PM",
      step: 60
    })),
        container = _render3.container;

    typeArrowDownToOpenSelectList(container);
    var options = (0, _react2.getAllByRole)(container, 'option');
    expectHourlyOptionsFrom9to5(options);
  });
  it('should use default step of 60 minutes',
  /*#__PURE__*/
  (0, _asyncToGenerator2["default"])(
  /*#__PURE__*/
  _regenerator["default"].mark(function _callee() {
    var _render4, container, options;

    return _regenerator["default"].wrap(function _callee$(_context) {
      while (1) {
        switch (_context.prev = _context.next) {
          case 0:
            _render4 = (0, _jestGlobals.fullRender)(_react["default"].createElement(_EzField["default"], {
              type: "time",
              label: label,
              start: "9:00 AM",
              end: "5:00 PM",
              value: "1:00 PM"
            })), container = _render4.container;
            typeArrowDownToOpenSelectList(container);
            options = (0, _react2.getAllByRole)(container, 'option');
            expectHourlyOptionsFrom9to5(options);

          case 4:
          case "end":
            return _context.stop();
        }
      }
    }, _callee);
  })));
  it('should trigger onChange after matching typed characters to an option', function () {
    var _onChange = jest.fn();

    var FieldWithHooks = function FieldWithHooks(props) {
      var _React$useState = _react["default"].useState('12:00 pm'),
          _React$useState2 = (0, _slicedToArray2["default"])(_React$useState, 2),
          time = _React$useState2[0],
          setTime = _React$useState2[1];

      return _react["default"].createElement(_EzField["default"], (0, _extends2["default"])({
        value: time
      }, props, {
        onChange: function onChange(e) {
          _onChange(e);

          setTime(e.target.value);
        }
      }));
    };

    var _render5 = (0, _jestGlobals.fullRender)(_react["default"].createElement(FieldWithHooks, {
      type: "time",
      start: "9:00 AM",
      end: "5:00 PM",
      step: 30,
      label: label
    })),
        container = _render5.container,
        rerender = _render5.rerender;

    var input = (0, _react2.getByLabelText)(container, label);

    var keyDown = function keyDown(key) {
      return _react2.fireEvent.keyDown(input, {
        key: key
      });
    };

    (0, _react2.act)(function () {
      keyDown('3');
      keyDown('Enter');
    });
    rerender(_react["default"].createElement(FieldWithHooks, {
      type: "time",
      start: "9:00 AM",
      end: "5:00 PM",
      step: 30,
      label: label
    }));
    expect(_onChange).toHaveBeenCalledTimes(1);
  });

  var typeArrowDownToOpenSelectList = function typeArrowDownToOpenSelectList(container) {
    var input = (0, _react2.getByLabelText)(container, label);

    var keyDown = function keyDown(key) {
      return _react2.fireEvent.keyDown(input, {
        key: key
      });
    }; // open the menu


    keyDown('ArrowDown');
  };

  var expectHourlyOptionsFrom9to5 = function expectHourlyOptionsFrom9to5(options) {
    expect(options[0]).toHaveTextContent('9:00 AM');
    expect(options[1]).toHaveTextContent('10:00 AM');
    expect(options[2]).toHaveTextContent('11:00 AM');
    expect(options[3]).toHaveTextContent('12:00 PM');
    expect(options[4]).toHaveTextContent('1:00 PM');
    expect(options[5]).toHaveTextContent('2:00 PM');
    expect(options[6]).toHaveTextContent('3:00 PM');
    expect(options[7]).toHaveTextContent('4:00 PM');
    expect(options[8]).toHaveTextContent('5:00 PM');
  };
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL3NyYy9jb21wb25lbnRzL0V6RmllbGQvX190ZXN0c19fL0V6RmllbGQudGltZS50ZXN0LnRzeCJdLCJuYW1lcyI6WyJzY29wZSIsIkV6RmllbGQiLCJFekZvcm1MYXlvdXQiLCJPcGVuIiwiTWVkaWEiLCJkZXNjcmliZSIsImxhYmVsIiwibWFya2Rvd24iLCJlelRpbWVJbnB1dFRlc3RzIiwiaXQiLCJjb250YWluZXIiLCJ0eXBlQXJyb3dEb3duVG9PcGVuU2VsZWN0TGlzdCIsIm9wdGlvbnMiLCJleHBlY3RIb3VybHlPcHRpb25zRnJvbTl0bzUiLCJvbkNoYW5nZSIsImplc3QiLCJmbiIsIkZpZWxkV2l0aEhvb2tzIiwicHJvcHMiLCJSZWFjdCIsInVzZVN0YXRlIiwidGltZSIsInNldFRpbWUiLCJlIiwidGFyZ2V0IiwidmFsdWUiLCJyZXJlbmRlciIsImlucHV0Iiwia2V5RG93biIsImtleSIsImZpcmVFdmVudCIsImV4cGVjdCIsInRvSGF2ZUJlZW5DYWxsZWRUaW1lcyIsInRvSGF2ZVRleHRDb250ZW50Il0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7QUFBQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFFQSxJQUFNQSxLQUFLLEdBQUc7QUFBQ0MsRUFBQUEsT0FBTyxFQUFQQSxtQkFBRDtBQUFVQyxFQUFBQSxZQUFZLEVBQVpBLG1CQUFWO0FBQXdCQyxFQUFBQSxJQUFJLEVBQUpBLGdCQUF4QjtBQUE4QkMsRUFBQUEsS0FBSyxFQUFMQTtBQUE5QixDQUFkO0FBRUFDLFFBQVEsQ0FBQyxTQUFELEVBQVksWUFBTTtBQUN4QixNQUFNQyxLQUFLLEdBQUcsYUFBZDtBQUVBLDhCQUFnQjtBQUFDQyxJQUFBQSxRQUFRLEVBQUVDLDJCQUFYO0FBQTZCUixJQUFBQSxLQUFLLEVBQUxBO0FBQTdCLEdBQWhCO0FBRUFTLEVBQUFBLEVBQUUsQ0FBQyxnREFBRCxFQUFtRCxZQUFNO0FBQUEsa0JBQ3JDLDZCQUNsQixnQ0FBQyxtQkFBRDtBQUFTLE1BQUEsSUFBSSxFQUFDLE1BQWQ7QUFBcUIsTUFBQSxLQUFLLEVBQUVILEtBQTVCO0FBQW1DLE1BQUEsS0FBSyxFQUFDLFNBQXpDO0FBQW1ELE1BQUEsR0FBRyxFQUFDLFNBQXZEO0FBQWlFLE1BQUEsSUFBSSxFQUFFO0FBQXZFLE1BRGtCLENBRHFDO0FBQUEsUUFDbERJLFNBRGtELFdBQ2xEQSxTQURrRDs7QUFLekRDLElBQUFBLDZCQUE2QixDQUFDRCxTQUFELENBQTdCO0FBRUEsUUFBTUUsT0FBTyxHQUFHLDBCQUFhRixTQUFiLEVBQXdCLFFBQXhCLENBQWhCO0FBRUFHLElBQUFBLDJCQUEyQixDQUFDRCxPQUFELENBQTNCO0FBQ0QsR0FWQyxDQUFGO0FBWUFILEVBQUFBLEVBQUUsQ0FBQywyRUFBRCxFQUE4RSxZQUFNO0FBQUEsbUJBQ2hFLDZCQUNsQixnQ0FBQyxtQkFBRDtBQUFTLE1BQUEsSUFBSSxFQUFDLE1BQWQ7QUFBcUIsTUFBQSxLQUFLLEVBQUVILEtBQTVCO0FBQW1DLE1BQUEsS0FBSyxFQUFDLFFBQXpDO0FBQWtELE1BQUEsR0FBRyxFQUFDLFFBQXREO0FBQStELE1BQUEsSUFBSSxFQUFFO0FBQXJFLE1BRGtCLENBRGdFO0FBQUEsUUFDN0VJLFNBRDZFLFlBQzdFQSxTQUQ2RTs7QUFLcEZDLElBQUFBLDZCQUE2QixDQUFDRCxTQUFELENBQTdCO0FBRUEsUUFBTUUsT0FBTyxHQUFHLDBCQUFhRixTQUFiLEVBQXdCLFFBQXhCLENBQWhCO0FBRUFHLElBQUFBLDJCQUEyQixDQUFDRCxPQUFELENBQTNCO0FBQ0QsR0FWQyxDQUFGO0FBWUFILEVBQUFBLEVBQUUsQ0FBQywrQ0FBRCxFQUFrRCxZQUFNO0FBQUEsbUJBQ3BDLDZCQUNsQixnQ0FBQyxtQkFBRDtBQUFTLE1BQUEsSUFBSSxFQUFDLE1BQWQ7QUFBcUIsTUFBQSxLQUFLLEVBQUVILEtBQTVCO0FBQW1DLE1BQUEsS0FBSyxFQUFDLFFBQXpDO0FBQWtELE1BQUEsR0FBRyxFQUFDLFFBQXREO0FBQStELE1BQUEsSUFBSSxFQUFFO0FBQXJFLE1BRGtCLENBRG9DO0FBQUEsUUFDakRJLFNBRGlELFlBQ2pEQSxTQURpRDs7QUFLeERDLElBQUFBLDZCQUE2QixDQUFDRCxTQUFELENBQTdCO0FBRUEsUUFBTUUsT0FBTyxHQUFHLDBCQUFhRixTQUFiLEVBQXdCLFFBQXhCLENBQWhCO0FBRUFHLElBQUFBLDJCQUEyQixDQUFDRCxPQUFELENBQTNCO0FBQ0QsR0FWQyxDQUFGO0FBWUFILEVBQUFBLEVBQUUsQ0FBQyx1Q0FBRDtBQUFBO0FBQUE7QUFBQTtBQUFBLCtCQUEwQztBQUFBOztBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUEsdUJBQ3RCLDZCQUNsQixnQ0FBQyxtQkFBRDtBQUFTLGNBQUEsSUFBSSxFQUFDLE1BQWQ7QUFBcUIsY0FBQSxLQUFLLEVBQUVILEtBQTVCO0FBQW1DLGNBQUEsS0FBSyxFQUFDLFNBQXpDO0FBQW1ELGNBQUEsR0FBRyxFQUFDLFNBQXZEO0FBQWlFLGNBQUEsS0FBSyxFQUFDO0FBQXZFLGNBRGtCLENBRHNCLEVBQ25DSSxTQURtQyxZQUNuQ0EsU0FEbUM7QUFLMUNDLFlBQUFBLDZCQUE2QixDQUFDRCxTQUFELENBQTdCO0FBRU1FLFlBQUFBLE9BUG9DLEdBTzFCLDBCQUFhRixTQUFiLEVBQXdCLFFBQXhCLENBUDBCO0FBUzFDRyxZQUFBQSwyQkFBMkIsQ0FBQ0QsT0FBRCxDQUEzQjs7QUFUMEM7QUFBQTtBQUFBO0FBQUE7QUFBQTtBQUFBO0FBQUEsR0FBMUMsR0FBRjtBQVlBSCxFQUFBQSxFQUFFLENBQUMsc0VBQUQsRUFBeUUsWUFBTTtBQUMvRSxRQUFNSyxTQUFRLEdBQUdDLElBQUksQ0FBQ0MsRUFBTCxFQUFqQjs7QUFFQSxRQUFNQyxjQUFjLEdBQUcsU0FBakJBLGNBQWlCLENBQUFDLEtBQUssRUFBSTtBQUFBLDRCQUNOQyxrQkFBTUMsUUFBTixDQUFlLFVBQWYsQ0FETTtBQUFBO0FBQUEsVUFDdkJDLElBRHVCO0FBQUEsVUFDakJDLE9BRGlCOztBQUc5QixhQUNFLGdDQUFDLG1CQUFEO0FBQ0UsUUFBQSxLQUFLLEVBQUVEO0FBRFQsU0FFTUgsS0FGTjtBQUdFLFFBQUEsUUFBUSxFQUFFLGtCQUFBSyxDQUFDLEVBQUk7QUFDYlQsVUFBQUEsU0FBUSxDQUFDUyxDQUFELENBQVI7O0FBQ0FELFVBQUFBLE9BQU8sQ0FBQ0MsQ0FBQyxDQUFDQyxNQUFGLENBQVNDLEtBQVYsQ0FBUDtBQUNEO0FBTkgsU0FERjtBQVVELEtBYkQ7O0FBSCtFLG1CQWtCakQsNkJBQzVCLGdDQUFDLGNBQUQ7QUFBZ0IsTUFBQSxJQUFJLEVBQUMsTUFBckI7QUFBNEIsTUFBQSxLQUFLLEVBQUMsU0FBbEM7QUFBNEMsTUFBQSxHQUFHLEVBQUMsU0FBaEQ7QUFBMEQsTUFBQSxJQUFJLEVBQUUsRUFBaEU7QUFBb0UsTUFBQSxLQUFLLEVBQUVuQjtBQUEzRSxNQUQ0QixDQWxCaUQ7QUFBQSxRQWtCeEVJLFNBbEJ3RSxZQWtCeEVBLFNBbEJ3RTtBQUFBLFFBa0I3RGdCLFFBbEI2RCxZQWtCN0RBLFFBbEI2RDs7QUFzQi9FLFFBQU1DLEtBQUssR0FBRyw0QkFBZWpCLFNBQWYsRUFBMEJKLEtBQTFCLENBQWQ7O0FBRUEsUUFBTXNCLE9BQU8sR0FBRyxTQUFWQSxPQUFVLENBQUFDLEdBQUc7QUFBQSxhQUFJQyxrQkFBVUYsT0FBVixDQUFrQkQsS0FBbEIsRUFBeUI7QUFBQ0UsUUFBQUEsR0FBRyxFQUFIQTtBQUFELE9BQXpCLENBQUo7QUFBQSxLQUFuQjs7QUFFQSxxQkFBSSxZQUFNO0FBQ1JELE1BQUFBLE9BQU8sQ0FBQyxHQUFELENBQVA7QUFDQUEsTUFBQUEsT0FBTyxDQUFDLE9BQUQsQ0FBUDtBQUNELEtBSEQ7QUFLQUYsSUFBQUEsUUFBUSxDQUFDLGdDQUFDLGNBQUQ7QUFBZ0IsTUFBQSxJQUFJLEVBQUMsTUFBckI7QUFBNEIsTUFBQSxLQUFLLEVBQUMsU0FBbEM7QUFBNEMsTUFBQSxHQUFHLEVBQUMsU0FBaEQ7QUFBMEQsTUFBQSxJQUFJLEVBQUUsRUFBaEU7QUFBb0UsTUFBQSxLQUFLLEVBQUVwQjtBQUEzRSxNQUFELENBQVI7QUFFQXlCLElBQUFBLE1BQU0sQ0FBQ2pCLFNBQUQsQ0FBTixDQUFpQmtCLHFCQUFqQixDQUF1QyxDQUF2QztBQUNELEdBbENDLENBQUY7O0FBb0NBLE1BQU1yQiw2QkFBNkIsR0FBRyxTQUFoQ0EsNkJBQWdDLENBQUFELFNBQVMsRUFBSTtBQUNqRCxRQUFNaUIsS0FBSyxHQUFHLDRCQUFlakIsU0FBZixFQUEwQkosS0FBMUIsQ0FBZDs7QUFFQSxRQUFNc0IsT0FBTyxHQUFHLFNBQVZBLE9BQVUsQ0FBQUMsR0FBRztBQUFBLGFBQUlDLGtCQUFVRixPQUFWLENBQWtCRCxLQUFsQixFQUF5QjtBQUFDRSxRQUFBQSxHQUFHLEVBQUhBO0FBQUQsT0FBekIsQ0FBSjtBQUFBLEtBQW5CLENBSGlELENBS2pEOzs7QUFDQUQsSUFBQUEsT0FBTyxDQUFDLFdBQUQsQ0FBUDtBQUNELEdBUEQ7O0FBU0EsTUFBTWYsMkJBQTJCLEdBQUcsU0FBOUJBLDJCQUE4QixDQUFBRCxPQUFPLEVBQUk7QUFDN0NtQixJQUFBQSxNQUFNLENBQUNuQixPQUFPLENBQUMsQ0FBRCxDQUFSLENBQU4sQ0FBbUJxQixpQkFBbkIsQ0FBcUMsU0FBckM7QUFDQUYsSUFBQUEsTUFBTSxDQUFDbkIsT0FBTyxDQUFDLENBQUQsQ0FBUixDQUFOLENBQW1CcUIsaUJBQW5CLENBQXFDLFVBQXJDO0FBQ0FGLElBQUFBLE1BQU0sQ0FBQ25CLE9BQU8sQ0FBQyxDQUFELENBQVIsQ0FBTixDQUFtQnFCLGlCQUFuQixDQUFxQyxVQUFyQztBQUNBRixJQUFBQSxNQUFNLENBQUNuQixPQUFPLENBQUMsQ0FBRCxDQUFSLENBQU4sQ0FBbUJxQixpQkFBbkIsQ0FBcUMsVUFBckM7QUFDQUYsSUFBQUEsTUFBTSxDQUFDbkIsT0FBTyxDQUFDLENBQUQsQ0FBUixDQUFOLENBQW1CcUIsaUJBQW5CLENBQXFDLFNBQXJDO0FBQ0FGLElBQUFBLE1BQU0sQ0FBQ25CLE9BQU8sQ0FBQyxDQUFELENBQVIsQ0FBTixDQUFtQnFCLGlCQUFuQixDQUFxQyxTQUFyQztBQUNBRixJQUFBQSxNQUFNLENBQUNuQixPQUFPLENBQUMsQ0FBRCxDQUFSLENBQU4sQ0FBbUJxQixpQkFBbkIsQ0FBcUMsU0FBckM7QUFDQUYsSUFBQUEsTUFBTSxDQUFDbkIsT0FBTyxDQUFDLENBQUQsQ0FBUixDQUFOLENBQW1CcUIsaUJBQW5CLENBQXFDLFNBQXJDO0FBQ0FGLElBQUFBLE1BQU0sQ0FBQ25CLE9BQU8sQ0FBQyxDQUFELENBQVIsQ0FBTixDQUFtQnFCLGlCQUFuQixDQUFxQyxTQUFyQztBQUNELEdBVkQ7QUFXRCxDQTdHTyxDQUFSIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IFJlYWN0IGZyb20gJ3JlYWN0JztcbmltcG9ydCB7dmlzdWFsU25hcHNob3RzfSBmcm9tICdzb3NpYSc7XG5pbXBvcnQge2dldEJ5TGFiZWxUZXh0LCBmaXJlRXZlbnQsIGdldEFsbEJ5Um9sZSwgYWN0fSBmcm9tICdAdGVzdGluZy1saWJyYXJ5L3JlYWN0JztcbmltcG9ydCBlelRpbWVJbnB1dFRlc3RzIGZyb20gJy4vRXpUaW1lSW5wdXQudGVzdC5tZCc7XG5pbXBvcnQgJy4uL21vY2tzJztcbmltcG9ydCBFekZpZWxkIGZyb20gJy4uL0V6RmllbGQnO1xuaW1wb3J0IHtmdWxsUmVuZGVyIGFzIHJlbmRlcn0gZnJvbSAnLi4vLi4vLi4vamVzdC1nbG9iYWxzJztcbmltcG9ydCB7RXpGb3JtTGF5b3V0fSBmcm9tICcuLi8uLi9pbmRleCc7XG5pbXBvcnQgT3BlbiBmcm9tICcuLi9PcGVuJztcbmltcG9ydCBNZWRpYSBmcm9tICcuLi9NZWRpYSc7XG5cbmNvbnN0IHNjb3BlID0ge0V6RmllbGQsIEV6Rm9ybUxheW91dCwgT3BlbiwgTWVkaWF9O1xuXG5kZXNjcmliZSgnRXpGaWVsZCcsICgpID0+IHtcbiAgY29uc3QgbGFiZWwgPSAnU2VsZWN0IHRpbWUnO1xuXG4gIHZpc3VhbFNuYXBzaG90cyh7bWFya2Rvd246IGV6VGltZUlucHV0VGVzdHMsIHNjb3BlfSk7XG5cbiAgaXQoJ3Nob3VsZCBnZW5lcmF0ZSB0aGUgY29ycmVjdCB0aW1lIHJhbmdlIG9wdGlvbnMnLCAoKSA9PiB7XG4gICAgY29uc3Qge2NvbnRhaW5lcn0gPSByZW5kZXIoXG4gICAgICA8RXpGaWVsZCB0eXBlPVwidGltZVwiIGxhYmVsPXtsYWJlbH0gc3RhcnQ9XCI5OjAwIGFtXCIgZW5kPVwiNTowMCBwbVwiIHN0ZXA9ezYwfSAvPlxuICAgICk7XG5cbiAgICB0eXBlQXJyb3dEb3duVG9PcGVuU2VsZWN0TGlzdChjb250YWluZXIpO1xuXG4gICAgY29uc3Qgb3B0aW9ucyA9IGdldEFsbEJ5Um9sZShjb250YWluZXIsICdvcHRpb24nKTtcblxuICAgIGV4cGVjdEhvdXJseU9wdGlvbnNGcm9tOXRvNShvcHRpb25zKTtcbiAgfSk7XG5cbiAgaXQoJ3N0YXJ0IGFuZCBlbmQgdGltZSBwcm9wcyBjYW4gb21pdCBzcGFjZSBiZXR3ZWVuIHRoZSB0aW1lIGFuZCB0aGUgbWVyaWRpZW0nLCAoKSA9PiB7XG4gICAgY29uc3Qge2NvbnRhaW5lcn0gPSByZW5kZXIoXG4gICAgICA8RXpGaWVsZCB0eXBlPVwidGltZVwiIGxhYmVsPXtsYWJlbH0gc3RhcnQ9XCI5OjAwYW1cIiBlbmQ9XCI1OjAwcG1cIiBzdGVwPXs2MH0gLz5cbiAgICApO1xuXG4gICAgdHlwZUFycm93RG93blRvT3BlblNlbGVjdExpc3QoY29udGFpbmVyKTtcblxuICAgIGNvbnN0IG9wdGlvbnMgPSBnZXRBbGxCeVJvbGUoY29udGFpbmVyLCAnb3B0aW9uJyk7XG5cbiAgICBleHBlY3RIb3VybHlPcHRpb25zRnJvbTl0bzUob3B0aW9ucyk7XG4gIH0pO1xuXG4gIGl0KCdzdGFydCBhbmQgZW5kIHRpbWUgcHJvcHMgYXJlIGNhc2UgaW5zZW5zaXRpdmUnLCAoKSA9PiB7XG4gICAgY29uc3Qge2NvbnRhaW5lcn0gPSByZW5kZXIoXG4gICAgICA8RXpGaWVsZCB0eXBlPVwidGltZVwiIGxhYmVsPXtsYWJlbH0gc3RhcnQ9XCI5OjAwQU1cIiBlbmQ9XCI1OjAwUE1cIiBzdGVwPXs2MH0gLz5cbiAgICApO1xuXG4gICAgdHlwZUFycm93RG93blRvT3BlblNlbGVjdExpc3QoY29udGFpbmVyKTtcblxuICAgIGNvbnN0IG9wdGlvbnMgPSBnZXRBbGxCeVJvbGUoY29udGFpbmVyLCAnb3B0aW9uJyk7XG5cbiAgICBleHBlY3RIb3VybHlPcHRpb25zRnJvbTl0bzUob3B0aW9ucyk7XG4gIH0pO1xuXG4gIGl0KCdzaG91bGQgdXNlIGRlZmF1bHQgc3RlcCBvZiA2MCBtaW51dGVzJywgYXN5bmMgKCkgPT4ge1xuICAgIGNvbnN0IHtjb250YWluZXJ9ID0gcmVuZGVyKFxuICAgICAgPEV6RmllbGQgdHlwZT1cInRpbWVcIiBsYWJlbD17bGFiZWx9IHN0YXJ0PVwiOTowMCBBTVwiIGVuZD1cIjU6MDAgUE1cIiB2YWx1ZT1cIjE6MDAgUE1cIiAvPlxuICAgICk7XG5cbiAgICB0eXBlQXJyb3dEb3duVG9PcGVuU2VsZWN0TGlzdChjb250YWluZXIpO1xuXG4gICAgY29uc3Qgb3B0aW9ucyA9IGdldEFsbEJ5Um9sZShjb250YWluZXIsICdvcHRpb24nKTtcblxuICAgIGV4cGVjdEhvdXJseU9wdGlvbnNGcm9tOXRvNShvcHRpb25zKTtcbiAgfSk7XG5cbiAgaXQoJ3Nob3VsZCB0cmlnZ2VyIG9uQ2hhbmdlIGFmdGVyIG1hdGNoaW5nIHR5cGVkIGNoYXJhY3RlcnMgdG8gYW4gb3B0aW9uJywgKCkgPT4ge1xuICAgIGNvbnN0IG9uQ2hhbmdlID0gamVzdC5mbigpO1xuXG4gICAgY29uc3QgRmllbGRXaXRoSG9va3MgPSBwcm9wcyA9PiB7XG4gICAgICBjb25zdCBbdGltZSwgc2V0VGltZV0gPSBSZWFjdC51c2VTdGF0ZSgnMTI6MDAgcG0nKTtcblxuICAgICAgcmV0dXJuIChcbiAgICAgICAgPEV6RmllbGRcbiAgICAgICAgICB2YWx1ZT17dGltZX1cbiAgICAgICAgICB7Li4ucHJvcHN9XG4gICAgICAgICAgb25DaGFuZ2U9e2UgPT4ge1xuICAgICAgICAgICAgb25DaGFuZ2UoZSk7XG4gICAgICAgICAgICBzZXRUaW1lKGUudGFyZ2V0LnZhbHVlKTtcbiAgICAgICAgICB9fVxuICAgICAgICAvPlxuICAgICAgKTtcbiAgICB9O1xuXG4gICAgY29uc3Qge2NvbnRhaW5lciwgcmVyZW5kZXJ9ID0gcmVuZGVyKFxuICAgICAgPEZpZWxkV2l0aEhvb2tzIHR5cGU9XCJ0aW1lXCIgc3RhcnQ9XCI5OjAwIEFNXCIgZW5kPVwiNTowMCBQTVwiIHN0ZXA9ezMwfSBsYWJlbD17bGFiZWx9IC8+XG4gICAgKTtcblxuICAgIGNvbnN0IGlucHV0ID0gZ2V0QnlMYWJlbFRleHQoY29udGFpbmVyLCBsYWJlbCkgYXMgSFRNTElucHV0RWxlbWVudDtcblxuICAgIGNvbnN0IGtleURvd24gPSBrZXkgPT4gZmlyZUV2ZW50LmtleURvd24oaW5wdXQsIHtrZXl9KTtcblxuICAgIGFjdCgoKSA9PiB7XG4gICAgICBrZXlEb3duKCczJyk7XG4gICAgICBrZXlEb3duKCdFbnRlcicpO1xuICAgIH0pO1xuXG4gICAgcmVyZW5kZXIoPEZpZWxkV2l0aEhvb2tzIHR5cGU9XCJ0aW1lXCIgc3RhcnQ9XCI5OjAwIEFNXCIgZW5kPVwiNTowMCBQTVwiIHN0ZXA9ezMwfSBsYWJlbD17bGFiZWx9IC8+KTtcblxuICAgIGV4cGVjdChvbkNoYW5nZSkudG9IYXZlQmVlbkNhbGxlZFRpbWVzKDEpO1xuICB9KTtcblxuICBjb25zdCB0eXBlQXJyb3dEb3duVG9PcGVuU2VsZWN0TGlzdCA9IGNvbnRhaW5lciA9PiB7XG4gICAgY29uc3QgaW5wdXQgPSBnZXRCeUxhYmVsVGV4dChjb250YWluZXIsIGxhYmVsKSBhcyBIVE1MSW5wdXRFbGVtZW50O1xuXG4gICAgY29uc3Qga2V5RG93biA9IGtleSA9PiBmaXJlRXZlbnQua2V5RG93bihpbnB1dCwge2tleX0pO1xuXG4gICAgLy8gb3BlbiB0aGUgbWVudVxuICAgIGtleURvd24oJ0Fycm93RG93bicpO1xuICB9O1xuXG4gIGNvbnN0IGV4cGVjdEhvdXJseU9wdGlvbnNGcm9tOXRvNSA9IG9wdGlvbnMgPT4ge1xuICAgIGV4cGVjdChvcHRpb25zWzBdKS50b0hhdmVUZXh0Q29udGVudCgnOTowMCBBTScpO1xuICAgIGV4cGVjdChvcHRpb25zWzFdKS50b0hhdmVUZXh0Q29udGVudCgnMTA6MDAgQU0nKTtcbiAgICBleHBlY3Qob3B0aW9uc1syXSkudG9IYXZlVGV4dENvbnRlbnQoJzExOjAwIEFNJyk7XG4gICAgZXhwZWN0KG9wdGlvbnNbM10pLnRvSGF2ZVRleHRDb250ZW50KCcxMjowMCBQTScpO1xuICAgIGV4cGVjdChvcHRpb25zWzRdKS50b0hhdmVUZXh0Q29udGVudCgnMTowMCBQTScpO1xuICAgIGV4cGVjdChvcHRpb25zWzVdKS50b0hhdmVUZXh0Q29udGVudCgnMjowMCBQTScpO1xuICAgIGV4cGVjdChvcHRpb25zWzZdKS50b0hhdmVUZXh0Q29udGVudCgnMzowMCBQTScpO1xuICAgIGV4cGVjdChvcHRpb25zWzddKS50b0hhdmVUZXh0Q29udGVudCgnNDowMCBQTScpO1xuICAgIGV4cGVjdChvcHRpb25zWzhdKS50b0hhdmVUZXh0Q29udGVudCgnNTowMCBQTScpO1xuICB9O1xufSk7XG4iXX0=