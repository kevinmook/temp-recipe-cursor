"use strict";

var _interopRequireWildcard = require("@babel/runtime/helpers/interopRequireWildcard");

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports["default"] = void 0;

var _defineProperty2 = _interopRequireDefault(require("@babel/runtime/helpers/defineProperty"));

var _slicedToArray2 = _interopRequireDefault(require("@babel/runtime/helpers/slicedToArray"));

var _extends2 = _interopRequireDefault(require("@babel/runtime/helpers/extends"));

var _objectWithoutProperties2 = _interopRequireDefault(require("@babel/runtime/helpers/objectWithoutProperties"));

var _react = _interopRequireWildcard(require("react"));

var _EzField = require("./EzField.styles");

var _EzLabel = _interopRequireDefault(require("../EzLabel"));

var _Icons = require("../Icons");

var _hooks = require("../../utils/hooks");

var _utils = require("../../utils");

var _EzChoice = _interopRequireDefault(require("./EzChoice"));

var _EzDateInput = _interopRequireDefault(require("./EzDateInput"));

var _EzTimeInput = _interopRequireDefault(require("./EzTimeInput"));

var _EzTextArea = _interopRequireDefault(require("./EzTextArea"));

var _EzSelect = _interopRequireDefault(require("./EzSelect"));

var _EzTextInput = _interopRequireDefault(require("./EzTextInput"));

function ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }

function _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { (0, _defineProperty2["default"])(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }

var inputElements = ['text', 'number'];
var choiceElements = ['radio', 'checkbox'];
var inlineElements = [].concat(inputElements);

var ErrorIcon = function ErrorIcon() {
  return _react["default"].createElement(_Icons.InsetIcon, {
    insetY0: true,
    right0: true,
    pr2: true
  }, _react["default"].createElement(_EzField.ErrorTriangle, null));
};

var EzCustomInput = (0, _react.forwardRef)(function (_ref, ref) {
  var Input = _ref.type,
      props = (0, _objectWithoutProperties2["default"])(_ref, ["type"]);
  return _react["default"].createElement(_EzField.CustomInputWrapper, props, _react["default"].createElement(Input, (0, _extends2["default"])({
    ref: ref
  }, (0, _utils.filterValidProps)(props))));
});

var resolveInputFromType = function resolveInputFromType(type) {
  if (choiceElements.includes(type)) return _EzChoice["default"];
  if (type === 'date') return _EzDateInput["default"];
  if (type === 'select') return _EzSelect["default"];
  if (type === 'time') return _EzTimeInput["default"];
  if (type === 'textarea') return _EzTextArea["default"];
  if (inputElements.includes(type)) return _EzTextInput["default"];
  return EzCustomInput;
};
/**
 * Form fields provide inputs for form data, such as text, dates, emails and other data types.
 */


var EzField = (0, _react.forwardRef)(function (props, ref) {
  var id = (0, _hooks.useUniqueId)();
  var labelId = (0, _hooks.useUniqueId)();
  var Input = resolveInputFromType(props.type);
  var helperText = props.helperText,
      label = props.label,
      touched = props.touched,
      error = props.error,
      type = props.type,
      maxLength = props.maxLength,
      labelHidden = props.labelHidden;
  var showInlineError = inlineElements.includes(type);
  var isChoiceElement = choiceElements.includes(type);

  var _useFocus = (0, _hooks.useFocus)(),
      _useFocus2 = (0, _slicedToArray2["default"])(_useFocus, 2),
      focused = _useFocus2[0],
      _useFocus2$ = _useFocus2[1],
      onBlur = _useFocus2$.onBlur,
      onFocus = _useFocus2$.onFocus;

  var _useHover = (0, _hooks.useHover)(),
      _useHover2 = (0, _slicedToArray2["default"])(_useHover, 2),
      hovered = _useHover2[0],
      mouseEvents = _useHover2[1];

  var _useInput = (0, _hooks.useInput)(props.value || ''),
      value = _useInput.value,
      onChange = _useInput.onChange;

  var active = focused || hovered;
  var showError = Boolean(touched && error);
  var fieldType = isChoiceElement ? 'fieldset' : undefined;
  var labelType = isChoiceElement ? 'legend' : 'label';

  var errorMessage = _react["default"].createElement(_EzField.InlineError, {
    active: active,
    showInlineError: showInlineError
  }, _react["default"].createElement("span", null, error));

  var relative = {
    position: 'relative'
  };
  return _react["default"].createElement(_EzField.Field, (0, _extends2["default"])({
    as: fieldType
  }, mouseEvents), !labelHidden && _react["default"].createElement("div", null, _react["default"].createElement("div", {
    style: relative
  }, _react["default"].createElement(_EzLabel["default"], {
    id: labelId,
    htmlFor: id,
    as: labelType,
    error: showError
  }, label), !showInlineError && showError && _react["default"].createElement(ErrorIcon, null)), !showInlineError && showError && errorMessage), helperText && _react["default"].createElement(_EzField.Helper, null, helperText), _react["default"].createElement("div", null, _react["default"].createElement("div", {
    style: relative
  }, _react["default"].createElement(Input, _objectSpread({}, props, {}, (0, _utils.wrapEvents)(props, {
    onBlur: onBlur,
    onFocus: onFocus,
    onChange: onChange
  }), {
    id: id,
    name: props.name || id,
    'aria-labelledby': labelId,
    ref: ref,
    showInlineError: showInlineError && showError || undefined
  })), showInlineError && showError && _react["default"].createElement(ErrorIcon, null)), showInlineError && showError && errorMessage), 'maxLength' in props && typeof value === 'string' && _react["default"].createElement(_EzField.CharacterLimit, null, value.length, "/", maxLength), labelHidden && _react["default"].createElement(_EzField.ScreenReaderOnly, {
    id: labelId
  }, label));
});
/**
 * defaultProps
 * @property {FieldTypes} type - uses 'text' by default.
 */

EzField.defaultProps = {
  type: 'text'
};
/**
 * @component
 */

var _default = EzField;
exports["default"] = _default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9jb21wb25lbnRzL0V6RmllbGQvRXpGaWVsZC50c3giXSwibmFtZXMiOlsiaW5wdXRFbGVtZW50cyIsImNob2ljZUVsZW1lbnRzIiwiaW5saW5lRWxlbWVudHMiLCJFcnJvckljb24iLCJFekN1c3RvbUlucHV0IiwicmVmIiwiSW5wdXQiLCJ0eXBlIiwicHJvcHMiLCJyZXNvbHZlSW5wdXRGcm9tVHlwZSIsImluY2x1ZGVzIiwiRXpDaG9pY2UiLCJFekRhdGVJbnB1dCIsIkV6U2VsZWN0IiwiRXpUaW1lSW5wdXQiLCJFelRleHRBcmVhIiwiRXpUZXh0SW5wdXQiLCJFekZpZWxkIiwiaWQiLCJsYWJlbElkIiwiaGVscGVyVGV4dCIsImxhYmVsIiwidG91Y2hlZCIsImVycm9yIiwibWF4TGVuZ3RoIiwibGFiZWxIaWRkZW4iLCJzaG93SW5saW5lRXJyb3IiLCJpc0Nob2ljZUVsZW1lbnQiLCJmb2N1c2VkIiwib25CbHVyIiwib25Gb2N1cyIsImhvdmVyZWQiLCJtb3VzZUV2ZW50cyIsInZhbHVlIiwib25DaGFuZ2UiLCJhY3RpdmUiLCJzaG93RXJyb3IiLCJCb29sZWFuIiwiZmllbGRUeXBlIiwidW5kZWZpbmVkIiwibGFiZWxUeXBlIiwiZXJyb3JNZXNzYWdlIiwicmVsYXRpdmUiLCJwb3NpdGlvbiIsIm5hbWUiLCJsZW5ndGgiLCJkZWZhdWx0UHJvcHMiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBQTs7QUFDQTs7QUFTQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFDQTs7QUFFQTs7QUFDQTs7Ozs7O0FBRUEsSUFBTUEsYUFBYSxHQUFHLENBQUMsTUFBRCxFQUFTLFFBQVQsQ0FBdEI7QUFDQSxJQUFNQyxjQUFjLEdBQUcsQ0FBQyxPQUFELEVBQVUsVUFBVixDQUF2QjtBQUNBLElBQU1DLGNBQWMsYUFBT0YsYUFBUCxDQUFwQjs7QUFFQSxJQUFNRyxTQUFTLEdBQUcsU0FBWkEsU0FBWTtB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QUhBLEdBUEo7QUFRSXFCLElBQUFBLGVBQWUsRUFBR0EsZUFBZSxJQUFJVSxTQUFwQixJQUFrQ0c7QUFSdkQsS0FERixFQVlHYixlQUFlLElBQUlVLFNBQW5CLElBQWdDLGdDQUFDLFNBQUQsT0FabkMsQ0FERixFQWVHVixlQUFlLElBQUlVLFNBQW5CLElBQWdDSyxZQWZuQyxDQWJGLEVBOEJHLGVBQWVqQyxLQUFmLElBQXdCLE9BQU95QixLQUFQLEtBQWlCLFFBQXpDLElBQ0MsZ0NBQUMsdUJBQUQsUUFDR0EsS0FBSyxDQUFDWSxNQURULE9BQ2tCckIsU0FEbEIsQ0EvQkosRUFtQ0dDLFdBQVcsSUFBSSxnQ0FBQyx5QkFBRDtBQUFrQixJQUFBLEVBQUUsRUFBRU47QUFBdEIsS0FBZ0NFLEtBQWhDLENBbkNsQixDQURGO0FBdUNELENBNURlLENBQWhCO0FBOERBOzs7OztBQUlBSixPQUFPLENBQUM2QixZQUFSLEdBQXVCO0FBQ3JCdkMsRUFBQUEsSUFBSSxFQUFFO0FBRGUsQ0FBdkI7QUFJQTs7OztlQUdlVSxPIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IFJlYWN0LCB7Zm9yd2FyZFJlZiwgQ1NTUHJvcGVydGllc30gZnJvbSAncmVhY3QnO1xuaW1wb3J0IHtcbiAgRmllbGQsXG4gIEhlbHBlcixcbiAgSW5saW5lRXJyb3IsXG4gIENoYXJhY3RlckxpbWl0LFxuICBFcnJvclRyaWFuZ2xlLFxuICBDdXN0b21JbnB1dFdyYXBwZXIsXG4gIFNjcmVlblJlYWRlck9ubHksXG59IGZyb20gJy4vRXpGaWVsZC5zdHlsZXMnO1xuaW1wb3J0IExhYmVsIGZyb20gJy4uL0V6TGFiZWwnO1xuaW1wb3J0IHtJbnNldEljb259IGZyb20gJy4uL0ljb25zJztcbmltcG9ydCB7dXNlRm9jdXMsIHVzZUhvdmVyLCB1c2VJbnB1dCwgdXNlVW5pcXVlSWR9IGZyb20gJy4uLy4uL3V0aWxzL2hvb2tzJztcbmltcG9ydCB7ZmlsdGVyVmFsaWRQcm9wcywgd3JhcEV2ZW50c30gZnJvbSAnLi4vLi4vdXRpbHMnO1xuaW1wb3J0IEV6Q2hvaWNlIGZyb20gJy4vRXpDaG9pY2UnO1xuaW1wb3J0IEV6RGF0ZUlucHV0IGZyb20gJy4vRXpEYXRlSW5wdXQnO1xuaW1wb3J0IEV6VGltZUlucHV0IGZyb20gJy4vRXpUaW1lSW5wdXQnO1xuaW1wb3J0IEV6VGV4dEFyZWEgZnJvbSAnLi9FelRleHRBcmVhJztcbmltcG9ydCB7UHJvcHMsIEN1c3RvbUlucHV0UHJvcHN9IGZyb20gJy4vRXpGaWVsZC50eXBlcyc7XG5pbXBvcnQgRXpTZWxlY3QgZnJvbSAnLi9FelNlbGVjdCc7XG5pbXBvcnQgRXpUZXh0SW5wdXQgZnJvbSAnLi9FelRleHRJbnB1dCc7XG5cbmNvbnN0IGlucHV0RWxlbWVudHMgPSBbJ3RleHQnLCAnbnVtYmVyJ107XG5jb25zdCBjaG9pY2VFbGVtZW50cyA9IFsncmFkaW8nLCAnY2hlY2tib3gnXTtcbmNvbnN0IGlubGluZUVsZW1lbnRzID0gWy4uLmlucHV0RWxlbWVudHNdO1xuXG5jb25zdCBFcnJvckljb24gPSAoKSA9PiAoXG4gIDxJbnNldEljb24gaW5zZXRZMCByaWdodDAgcHIyPlxuICAgIDxFcnJvclRyaWFuZ2xlIC8+XG4gIDwvSW5zZXRJY29uPlxuKTtcblxuY29uc3QgRXpDdXN0b21JbnB1dCA9IGZvcndhcmRSZWY8SFRNTEVsZW1lbnQsIEN1c3RvbUlucHV0UHJvcHM+KCh7dHlwZTogSW5wdXQsIC4uLnByb3BzfSwgcmVmKSA9PiAoXG4gIDxDdXN0b21JbnB1dFdyYXBwZXIgey4uLnByb3BzfT5cbiAgICA8SW5wdXQgcmVmPXtyZWZ9IHsuLi5maWx0ZXJWYWxpZFByb3BzKHByb3BzKX0gLz5cbiAgPC9DdXN0b21JbnB1dFdyYXBwZXI+XG4pKTtcblxuY29uc3QgcmVzb2x2ZUlucHV0RnJvbVR5cGUgPSB0eXBlID0+IHtcbiAgaWYgKGNob2ljZUVsZW1lbnRzLmluY2x1ZGVzKHR5cGUpKSByZXR1cm4gRXpDaG9pY2U7XG4gIGlmICh0eXBlID09PSAnZGF0ZScpIHJldHVybiBFekRhdGVJbnB1dDtcbiAgaWYgKHR5cGUgPT09ICdzZWxlY3QnKSByZXR1cm4gRXpTZWxlY3Q7XG4gIGlmICh0eXBlID09PSAndGltZScpIHJldHVybiBFelRpbWVJbnB1dDtcbiAgaWYgKHR5cGUgPT09ICd0ZXh0YXJlYScpIHJldHVybiBFelRleHRBcmVhO1xuICBpZiAoaW5wdXRFbGVtZW50cy5pbmNsdWRlcyh0eXBlKSkgcmV0dXJuIEV6VGV4dElucHV0O1xuICByZXR1cm4gRXpDdXN0b21JbnB1dDtcbn07XG5cbi8qKlxuICogRm9ybSBmaWVsZHMgcHJvdmlkZSBpbnB1dHMgZm9yIGZvcm0gZGF0YSwgc3VjaCBhcyB0ZXh0LCBkYXRlcywgZW1haWxzIGFuZCBvdGhlciBkYXRhIHR5cGVzLlxuICovXG5jb25zdCBFekZpZWxkID0gZm9yd2FyZFJlZjxIVE1MRWxlbWVudCwgUHJvcHM+KChwcm9wcywgcmVmKSA9PiB7XG4gIGNvbnN0IGlkID0gdXNlVW5pcXVlSWQoKTtcbiAgY29uc3QgbGFiZWxJZCA9IHVzZVVuaXF1ZUlkKCk7XG4gIGNvbnN0IElucHV0ID0gcmVzb2x2ZUlucHV0RnJvbVR5cGUocHJvcHMudHlwZSk7XG4gIGNvbnN0IHtoZWxwZXJUZXh0LCBsYWJlbCwgdG91Y2hlZCwgZXJyb3IsIHR5cGUsIG1heExlbmd0aCwgbGFiZWxIaWRkZW59ID0gcHJvcHM7XG4gIGNvbnN0IHNob3dJbmxpbmVFcnJvciA9IGlubGluZUVsZW1lbnRzLmluY2x1ZGVzKHR5cGUgYXMgc3RyaW5nKTtcbiAgY29uc3QgaXNDaG9pY2VFbGVtZW50ID0gY2hvaWNlRWxlbWVudHMuaW5jbHVkZXModHlwZSBhcyBzdHJpbmcpO1xuICBjb25zdCBbZm9jdXNlZCwge29uQmx1ciwgb25Gb2N1c31dID0gdXNlRm9jdXMoKTtcbiAgY29uc3QgW2hvdmVyZWQsIG1vdXNlRXZlbnRzXSA9IHVzZUhvdmVyKCk7XG4gIGNvbnN0IHt2YWx1ZSwgb25DaGFuZ2V9ID0gdXNlSW5wdXQocHJvcHMudmFsdWUgfHwgJycpO1xuICBjb25zdCBhY3RpdmUgPSBmb2N1c2VkIHx8IGhvdmVyZWQ7XG4gIGNvbnN0IHNob3dFcnJvciA9IEJvb2xlYW4odG91Y2hlZCAmJiBlcnJvcik7XG4gIGNvbnN0IGZpZWxkVHlwZSA9IGlzQ2hvaWNlRWxlbWVudCA/ICdmaWVsZHNldCcgOiB1bmRlZmluZWQ7XG4gIGNvbnN0IGxhYmVsVHlwZSA9IGlzQ2hvaWNlRWxlbWVudCA/ICdsZWdlbmQnIDogJ2xhYmVsJztcbiAgY29uc3QgZXJyb3JNZXNzYWdlID0gKFxuICAgIDxJbmxpbmVFcnJvciBhY3RpdmU9e2FjdGl2ZX0gc2hvd0lubGluZUVycm9yPXtzaG93SW5saW5lRXJyb3J9PlxuICAgICAgPHNwYW4+e2Vycm9yfTwvc3Bhbj5cbiAgICA8L0lubGluZUVycm9yPlxuICApO1xuICBjb25zdCByZWxhdGl2ZTogQ1NTUHJvcGVydGllcyA9IHtwb3NpdGlvbjogJ3JlbGF0aXZlJ307XG5cbiAgcmV0dXJuIChcbiAgICA8RmllbGQgYXM9e2ZpZWxkVHlwZX0gey4uLihtb3VzZUV2ZW50cyBhcyBhbnkpfT5cbiAgICAgIHshbGFiZWxIaWRkZW4gJiYgKFxuICAgICAgICA8ZGl2PlxuICAgICAgICAgIDxkaXYgc3R5bGU9e3JlbGF0aXZlfT5cbiAgICAgICAgICAgIDxMYWJlbCBpZD17bGFiZWxJZH0gaHRtbEZvcj17aWR9IGFzPXtsYWJlbFR5cGV9IGVycm9yPXtzaG93RXJyb3J9PlxuICAgICAgICAgICAgICB7bGFiZWx9XG4gICAgICAgICAgICA8L0xhYmVsPlxuICAgICAgICAgICAgeyFzaG93SW5saW5lRXJyb3IgJiYgc2hvd0Vycm9yICYmIDxFcnJvckljb24gLz59XG4gICAgICAgICAgPC9kaXY+XG4gICAgICAgICAgeyFzaG93SW5saW5lRXJyb3IgJiYgc2hvd0Vycm9yICYmIGVycm9yTWVzc2FnZX1cbiAgICAgICAgPC9kaXY+XG4gICAgICApfVxuICAgICAge2hlbHBlclRleHQgJiYgPEhlbHBlcj57aGVscGVyVGV4dH08L0hlbHBlcj59XG4gICAgICA8ZGl2PlxuICAgICAgICA8ZGl2IHN0eWxlPXtyZWxhdGl2ZX0+XG4gICAgICAgICAgPElucHV0XG4gICAgICAgICAgICB7Li4ue1xuICAgICAgICAgICAgICAuLi5wcm9wcyxcbiAgICAgICAgICAgICAgLi4ud3JhcEV2ZW50cyhwcm9wcywge29uQmx1ciwgb25Gb2N1cywgb25DaGFuZ2V9KSxcbiAgICAgICAgICAgICAgaWQsXG4gICAgICAgICAgICAgIG5hbWU6IHByb3BzLm5hbWUgfHwgaWQsXG4gICAgICAgICAgICAgICdhcmlhLWxhYmVsbGVkYnknOiBsYWJlbElkLFxuICAgICAgICAgICAgICByZWYsXG4gICAgICAgICAgICAgIHNob3dJbmxpbmVFcnJvcjogKHNob3dJbmxpbmVFcnJvciAmJiBzaG93RXJyb3IpIHx8IHVuZGVmaW5lZCxcbiAgICAgICAgICAgIH19XG4gICAgICAgICAgLz5cbiAgICAgICAgICB7c2hvd0lubGluZUVycm9yICYmIHNob3dFcnJvciAmJiA8RXJyb3JJY29uIC8+fVxuICAgICAgICA8L2Rpdj5cbiAgICAgICAge3Nob3dJbmxpbmVFcnJvciAmJiBzaG93RXJyb3IgJiYgZXJyb3JNZXNzYWdlfVxuICAgICAgPC9kaXY+XG4gICAgICB7J21heExlbmd0aCcgaW4gcHJvcHMgJiYgdHlwZW9mIHZhbHVlID09PSAnc3RyaW5nJyAmJiAoXG4gICAgICAgIDxDaGFyYWN0ZXJMaW1pdD5cbiAgICAgICAgICB7dmFsdWUubGVuZ3RofS97bWF4TGVuZ3RofVxuICAgICAgICA8L0NoYXJhY3RlckxpbWl0PlxuICAgICAgKX1cbiAgICAgIHtsYWJlbEhpZGRlbiAmJiA8U2NyZWVuUmVhZGVyT25seSBpZD17bGFiZWxJZH0+e2xhYmVsfTwvU2NyZWVuUmVhZGVyT25seT59XG4gICAgPC9GaWVsZD5cbiAgKTtcbn0pO1xuXG4vKipcbiAqIGRlZmF1bHRQcm9wc1xuICogQHByb3BlcnR5IHtGaWVsZFR5cGVzfSB0eXBlIC0gdXNlcyAndGV4dCcgYnkgZGVmYXVsdC5cbiAqL1xuRXpGaWVsZC5kZWZhdWx0UHJvcHMgPSB7XG4gIHR5cGU6ICd0ZXh0Jyxcbn07XG5cbi8qKlxuICogQGNvbXBvbmVudFxuICovXG5leHBvcnQgZGVmYXVsdCBFekZpZWxkO1xuIl19