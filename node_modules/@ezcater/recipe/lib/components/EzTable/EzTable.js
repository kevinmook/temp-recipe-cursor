"use strict";

var _interopRequireWildcard = require("@babel/runtime/helpers/interopRequireWildcard");

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports["default"] = void 0;

var _extends2 = _interopRequireDefault(require("@babel/runtime/helpers/extends"));

var _defineProperty2 = _interopRequireDefault(require("@babel/runtime/helpers/defineProperty"));

var _objectWithoutProperties2 = _interopRequireDefault(require("@babel/runtime/helpers/objectWithoutProperties"));

var _slicedToArray2 = _interopRequireDefault(require("@babel/runtime/helpers/slicedToArray"));

var _react = _interopRequireWildcard(require("react"));

var _EzCard = require("../EzCard");

var _EzCheckbox = _interopRequireDefault(require("../EzCheckbox"));

var _EzButton = _interopRequireDefault(require("../EzButton"));

var _EzLayout = _interopRequireDefault(require("../EzLayout"));

var _EzTable = require("./EzTable.styles");

var _useSorting2 = _interopRequireDefault(require("./useSorting"));

var _en = _interopRequireDefault(require("./en"));

var _utils = require("../../utils");

var _hooks = require("../../utils/hooks");

var _useOverflowDetection3 = _interopRequireDefault(require("./useOverflowDetection"));

var _useExpandedClickTarget = _interopRequireDefault(require("./useExpandedClickTarget"));

function ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }

function _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { (0, _defineProperty2["default"])(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }

var TableContext = (0, _react.createContext)(null);

var SortDirection = function SortDirection(_ref) {
  var direction = _ref.direction;
  return _react["default"].createElement("svg", {
    width: "0.5em",
    height: "0.4em",
    viewBox: "0 0 1 1",
    preserveAspectRatio: "none",
    xmlns: "http://www.w3.org/2000/svg",
    version: "1.1"
  }, direction === 'asc' ? _react["default"].createElement("polygon", {
    points: "0.5,0 1,1 0,1"
  }) : _react["default"].createElement("polygon", {
    points: "0.5,1 0,0 1,0"
  }));
};

var Thead = function Thead() {
  var _React$useContext = _react["default"].useContext(TableContext),
      columns = _React$useContext.columns,
      items = _React$useContext.items,
      sorting = _React$useContext.sorting,
      selection = _React$useContext.selection;

  var col = columns.find(function (c) {
    return c.defaultSort;
  });
  var initialSort = col && {
    column: col,
    direction: col.defaultSort
  };

  var _useSorting = (0, _useSorting2["default"])(initialSort),
      direction = _useSorting.direction,
      _onClick = _useSorting.onClick,
      isSorted = _useSorting.isSorted;

  return _react["default"].createElement("thead", null, _react["default"].createElement("tr", null, selection && _react["default"].createElement(_EzTable.Th, null, _react["default"].createElement(_EzCheckbox["default"], {
    label: "Select all",
    onChange: selection.onBulkSelectClick,
    checked: items.length === selection.selected.length
  })), columns.map(function (column, cellIndex) {
    var sortable = column.sortable,
        heading = column.heading,
        numeric = column.numeric;
    return _react["default"].createElement(_EzTable.Th, {
      key: column.key || cellIndex,
      numeric: numeric,
      sortable: sortable,
      sorted: isSorted(column),
      onClick: function onClick(event) {
        return _onClick(event, column, sorting.onSortClick);
      }
    }, _react["default"].createElement("span", null, heading, " ", sortable && _react["default"].createElement(SortDirection, {
      direction: direction
    })));
  })), _react["default"].createElement(SelectionStateBanner, null));
};

var SelectionStateBanner = function SelectionStateBanner() {
  var _useTranslation = (0, _hooks.useTranslation)(_en["default"]),
      t = _useTranslation.t;

  var _useContext = (0, _react.useContext)(TableContext),
      columns = _useContext.columns,
      items = _useContext.items,
      selection = _useContext.selection,
      pagination = _useContext.pagination;

  if (!selection || !pagination) return null;
  if (!selection.onSelectAllClick) return null;
  if (selection.selected.length !== items.length && !selection.allSelected) return null;
  return _react["default"].createElement("tr", null, _react["default"].createElement("td", {
    colSpan: columns.length + 1
  }, _react["default"].createElement(_EzLayout["default"], {
    layout: "basic"
  }, selection.allSelected || items.length === pagination.totalRows ? _react["default"].createElement("span", null, t('All {{totalRowCount}} rows are selected.', {
    totalRowCount: pagination.totalRows
  })) : _react["default"].createElement(_react["default"].Fragment, null, _react["default"].createElement("span", null, t('All {{selectedCount}} rows on this page are selected.', {
    selectedCount: selection.selected.length
  })), _react["default"].createElement(_EzButton["default"], {
    use: "tertiary",
    onClick: (0, _utils.wrapEvent)(selection.onSelectAllClick, function () {
      return selection.setAllSelected(true);
    })
  }, t('Select all {{totalRowCount}} rows', {
    totalRowCount: pagination.totalRows
  }))), _react["default"].createElement(_EzButton["default"], {
    use: "tertiary",
    onClick: selection.onSelectNoneClick
  }, t('Clear selection')))));
};

var TRow = function TRow(_ref2) {
  var item = _ref2.item;

  var _useContext2 = (0, _react.useContext)(TableContext),
      columns = _useContext2.columns,
      selection = _useContext2.selection;

  var _useExpandedClickTarg = (0, _useExpandedClickTarget["default"])(),
      _useExpandedClickTarg2 = (0, _slicedToArray2["default"])(_useExpandedClickTarg, 2),
      targetRef = _useExpandedClickTarg2[0],
      _useExpandedClickTarg3 = _useExpandedClickTarg2[1],
      ref = _useExpandedClickTarg3.ref,
      clickable = _useExpandedClickTarg3.clickable,
      onClick = _useExpandedClickTarg3.onClick,
      onMouseEnter = _useExpandedClickTarg3.onMouseEnter;

  return _react["default"].createElement(_EzTable.ClickableTr, {
    ref: ref,
    clickable: clickable,
    onClick: onClick,
    onMouseEnter: onMouseEnter
  }, selection && _react["default"].createElement(_EzTable.Td, null, _react["default"].createElement(_EzCheckbox["default"], {
    label: "Select row",
    checked: selection.selected.includes(item),
    onChange: function onChange(event) {
      return selection.onRowSelectClick(event, {
        item: item
      });
    }
  })), columns.map(function (_ref3, cellIndex) {
    var component = _ref3.component,
        numeric = _ref3.numeric;
    return _react["default"].createElement(_EzTable.Td, {
      key: cellIndex,
      numeric: numeric
    }, (0, _react.createElement)(component, {
      item: item,
      linkRef: targetRef
    }));
  }));
};

var Tbody = function Tbody() {
  var _useContext3 = (0, _react.useContext)(TableContext),
      items = _useContext3.items;

  return _react["default"].createElement("tbody", null, items.map(function (item, rowIndex) {
    return _react["default"].createElement(TRow, {
      key: rowIndex,
      item: item
    });
  }));
};

var TablePagination = function TablePagination(_ref4) {
  var pagination = _ref4.pagination;

  var _useTranslation2 = (0, _hooks.useTranslation)(_en["default"]),
      t = _useTranslation2.t;

  var pages = Math.ceil(pagination.totalRows / pagination.rowsPerPage);
  return _react["default"].createElement(_EzCard.EzCardFooter, null, _react["default"].createElement(_EzLayout["default"], {
    layout: "split"
  }, _react["default"].createElement(_EzTable.TablePaginationNavItems, null, _react["default"].createElement(_EzButton["default"], {
    use: "tertiary",
    onClick: pagination.onPrevPageClick,
    disabled: pagination.currentPage === 1
  }, '‹ ', t('Previous Page')), _react["default"].createElement("span", null, t('Page {{currentPage}} of {{pages}}', {
    currentPage: pagination.currentPage,
    pages: pages
  })), _react["default"].createElement(_EzButton["default"], {
    use: "tertiary",
    onClick: pagination.onNextPageClick,
    disabled: pagination.currentPage === pages
  }, t('Next Page'), ' ›')), _react["default"].createElement(_EzTable.TablePaginationRowCountDropdown, {
    defaultValue: pagination.rowsPerPage,
    onChange: pagination.onRowsPerPageChange
  }, pagination.rowsPerPageOptions.map(function (value) {
    return _react["default"].createElement("option", {
      key: value,
      value: value
    }, t('{{num}} rows per page', {
      num: value
    }));
  }))));
};
/**
 * Tables display information in a way that’s easy to scan,
 * so that users can look for patterns and insights.
 * They can be embedded in primary content, such as cards.
 */


var EzTable = function EzTable(_ref5) {
  var actions = _ref5.actions,
      title = _ref5.title,
      subtitle = _ref5.subtitle,
      columns = _ref5.columns,
      items = _ref5.items,
      selection = _ref5.selection,
      onSortClick = _ref5.onSortClick,
      pagination = _ref5.pagination;

  var _useState = (0, _react.useState)(false),
      _useState2 = (0, _slicedToArray2["default"])(_useState, 2),
      allSelected = _useState2[0],
      setAllSelected = _useState2[1];

  var selected = selection && items.filter(selection.isRowSelected);
  var numSelectedOnPage = selected && selected.length;

  var _ref6 = pagination || {},
      currentPage = _ref6.currentPage,
      rowsPerPage = _ref6.rowsPerPage;

  var _useScrollPosition = (0, _hooks.useScrollPosition)(),
      _useScrollPosition2 = (0, _slicedToArray2["default"])(_useScrollPosition, 2),
      x = _useScrollPosition2[0].x,
      scrollEvents = _useScrollPosition2[1];

  var isScrolling = x > 0;

  var _useOverflowDetection = (0, _useOverflowDetection3["default"])(),
      _useOverflowDetection2 = (0, _slicedToArray2["default"])(_useOverflowDetection, 2),
      isOverflowing = _useOverflowDetection2[0],
      overflowDetection = _useOverflowDetection2[1];

  (0, _react.useEffect)(function () {
    return setAllSelected(false);
  }, [numSelectedOnPage, currentPage, rowsPerPage]);
  var mappedColumns = columns.map(function (_ref7) {
    var heading = _ref7.heading,
        accessor = _ref7.accessor,
        _ref7$key = _ref7.key,
        key = _ref7$key === void 0 ? typeof accessor === 'string' ? accessor : undefined : _ref7$key,
        _ref7$component = _ref7.component,
        component = _ref7$component === void 0 ? typeof accessor === 'function' ? accessor : function (_ref8) {
      var item = _ref8.item;
      return _react["default"].createElement(_react["default"].Fragment, null, item[key]);
    } : _ref7$component,
        sortable = _ref7.sortable,
        rest = (0, _objectWithoutProperties2["default"])(_ref7, ["heading", "accessor", "key", "component", "sortable"]);
    return _objectSpread({
      heading: heading,
      key: key,
      component: component,
      sortable: sortable
    }, rest);
  });

  var table = _react["default"].createElement(TableContext.Provider, {
    value: {
      items: items,
      selection: selection && _objectSpread({}, selection, {
        selected: selected,
        allSelected: allSelected,
        setAllSelected: setAllSelected
      }),
      columns: mappedColumns,
      pagination: pagination,
      sorting: {
        onSortClick: onSortClick
      }
    }
  }, _react["default"].createElement(_EzTable.Container, (0, _extends2["default"])({
    cols: columns.length,
    selectable: !!selection,
    overflowing: isOverflowing,
    isScrolling: isScrolling
  }, scrollEvents, {
    ref: overflowDetection.ref
  }), _react["default"].createElement(_EzTable.Table, {
    selectable: !!selection,
    use: !title ? 'simple' : 'full'
  }, _react["default"].createElement(Thead, null), _react["default"].createElement(Tbody, null))));

  if (!title) return table;
  return _react["default"].createElement(_EzCard.EzCard, {
    title: title,
    subtitle: subtitle,
    actions: actions
  }, _react["default"].createElement(_EzTable.TableCardSection, null, table), pagination && _react["default"].createElement(TablePagination, {
    pagination: pagination
  }));
};

var _default = EzTable;
exports["default"] = _default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9jb21wb25lbnRzL0V6VGFibGUvRXpUYWJsZS50c3giXSwibmFtZXMiOlsiVGFibGVDb250ZXh0IiwiU29ydERpcmVjdGlvbiIsImRpcmVjdGlvbiIsIlRoZWFkIiwiUmVhY3QiLCJ1c2VDb250ZXh0IiwiY29sdW1ucyIsIml0ZW1zIiwic29ydGluZyIsInNlbGVjdGlvbiIsImNvbCIsImZpbmQiLCJjIiwiZGVmYXVsdFNvcnQiLCJpbml0aWFsU29ydCIsImNvbHVtbiIsIm9uQ2xpY2siLCJpc1NvcnRlZCIsIm9uQnVsa1NlbGVjdENsaWNrIiwibGVuZ3RoIiwic2VsZWN0ZWQiLCJtYXAiLCJjZWxsSW5kZXgiLCJzb3J0YWJsZSIsImhlYWRpbmciLCJudW1lcmljIiwia2V5IiwiZXZlbnQiLCJvblNvcnRDbGljayIsIlNlbGVjdGlvblN0YXRlQmFubmVyIiwiZW4iLCJ0IiwicGFnaW5hdGlvbiIsIm9uU2VsZWN0QWxsQ2xpY2siLCJhbGxTZWxlY3RlZCIsInRvdGFsUm93cyIsInRvdGFsUm93Q291bnQiLCJzZWxlY3RlZENvdW50Iiwic2V0QWxsU2VsZWN0ZWQiLCJvblNlbGVjdE5vbmVDbGljayIsIlRSb3ciLCJpdGVtIiwidGFyZ2V0UmVmIiwicmVmIiwiY2xpY2thYmxlIiwib25Nb3VzZUVudGVyIiwiaW5jbHVkZXMiLCJvblJvd1NlbGVjdENsaWNrIiwiY29tcG9uZW50IiwibGlua1JlZiIsIlRib2R5Iiwicm93SW5kZXgiLCJUYWJsZVBhZ2luYXRpb24iLCJwYWdlcyIsIk1hdGgiLCJjZWlsIiwicm93c1BlclBhZ2UiLCJvblByZXZQYWdlQ2xpY2siLCJjdXJyZW50UGFnZSIsIm9uTmV4dFBhZ2VDbGljayIsIm9uUm93c1BlclBhZ2VDaGFuZ2UiLCJyb3dzUGVyUGFnZU9wdGlvbnMiLCJ2YWx1ZSIsIm51bSIsIkV6VGFibGUiLCJhY3Rpb25zIiwidGl0bGUiLCJzdWJ0aXRsZSIsImZpbHRlciIsImlzUm93U2VsZWN0ZWQiLCJudW1TZWxlY3RlZE9uUGFnZSIsIngiLCJzY3JvbGxFdmVudHMiLCJpc1Njcm9sbGluZyIsImlzT3ZlcmZsb3dpbmciLCJvdmVyZmxvd0RldGVjdGlvbiIsIm1hcHBlZENvbHVtbnMiLCJhY2Nlc3NvciIsInVuZGVmaW5lZCIsInJlc3QiLCJ0YWJsZSJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUFBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUVBOztBQVVBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOztBQUNBOzs7Ozs7QUFFQSxJQUFNQSxZQUFZLEdBQUcsMEJBQWMsSUFBZCxDQUFyQjs7QUFFQSxJQUFNQyxhQUFhLEdBQUcsU0FBaEJBLGFBQWdCO0FBQUEsTUFBRUMsU0FBRixRQUFFQSxTQUFGO0FBQUEsU0FDcEI7QUFDRSxJQUFBLEtBQUssRUFBQyxPQURSO0FBRUUsSUFBQSxNQUFNLEVBQUMsT0FGVDtBQUdFLElBQUEsT0FBTyxFQUFDLFNBSFY7QUFJRSxJQUFBLG1CQUFtQixFQUFDLE1BSnRCO0FBS0UsSUFBQSxLQUFLLEVBQUMsNEJBTFI7QUFNRSxJQUFBLE9BQU8sRUFBQztBQU5WLEtBUUdBLFNBQVMsS0FBSyxLQUFkLEdBQXNCO0FBQVMsSUFBQSxNQUFNLEVBQUM7QUFBaEIsSUFBdEIsR0FBMkQ7QUFBUyxJQUFBLE1BQU0sRUFBQztBQUFoQixJQVI5RCxDQURvQjtBQUFBLENBQXRCOztBQWFBLElBQU1DLEtBQUssR0FBRyxTQUFSQSxLQUFRLEdBQU07QUFBQSwwQkFDMkJDLGtCQUFNQyxVQUFOLENBQWlCTCxZQUFqQixDQUQzQjtBQUFBLE1BQ1hNLE9BRFcscUJBQ1hBLE9BRFc7QUFBQSxNQUNGQyxLQURFLHFCQUNGQSxLQURFO0FBQUEsTUFDS0MsT0FETCxxQkFDS0EsT0FETDtBQUFBLE1BQ2NDLFNBRGQscUJBQ2NBLFNBRGQ7O0FBRWxCLE1BQU1DLEdBQUcsR0FBR0osT0FBTyxDQUFDSyxJQUFSLENBQWEsVUFBQUMsQ0FBQztBQUFBLFdBQUlBLENBQUMsQ0FBQ0Ms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dGV4dCwgdXNlU3RhdGUsIHVzZUVmZmVjdH0gZnJvbSAncmVhY3QnO1xuaW1wb3J0IHtFekNhcmQsIEV6Q2FyZEZvb3Rlcn0gZnJvbSAnLi4vRXpDYXJkJztcbmltcG9ydCBFekNoZWNrYm94IGZyb20gJy4uL0V6Q2hlY2tib3gnO1xuaW1wb3J0IEV6QnV0dG9uIGZyb20gJy4uL0V6QnV0dG9uJztcbmltcG9ydCBFekxheW91dCBmcm9tICcuLi9FekxheW91dCc7XG5pbXBvcnQge1RhYmxlUHJvcHN9IGZyb20gJy4vRXpUYWJsZS50eXBlcyc7XG5pbXBvcnQge1xuICBDb250YWluZXIsXG4gIFRhYmxlLFxuICBUaCxcbiAgVGQsXG4gIENsaWNrYWJsZVRyLFxuICBUYWJsZUNhcmRTZWN0aW9uLFxuICBUYWJsZVBhZ2luYXRpb25OYXZJdGVtcyxcbiAgVGFibGVQYWdpbmF0aW9uUm93Q291bnREcm9wZG93bixcbn0gZnJvbSAnLi9FelRhYmxlLnN0eWxlcyc7XG5pbXBvcnQgdXNlU29ydGluZyBmcm9tICcuL3VzZVNvcnRpbmcnO1xuaW1wb3J0IGVuIGZyb20gJy4vZW4nO1xuaW1wb3J0IHt3cmFwRXZlbnR9IGZyb20gJy4uLy4uL3V0aWxzJztcbmltcG9ydCB7dXNlVHJhbnNsYXRpb24sIHVzZVNjcm9sbFBvc2l0aW9ufSBmcm9tICcuLi8uLi91dGlscy9ob29rcyc7XG5pbXBvcnQgdXNlT3ZlcmZsb3dEZXRlY3Rpb24gZnJvbSAnLi91c2VPdmVyZmxvd0RldGVjdGlvbic7XG5pbXBvcnQgdXNlRXhwYW5kZWRDbGlja1RhcmdldCBmcm9tICcuL3VzZUV4cGFuZGVkQ2xpY2tUYXJnZXQnO1xuXG5jb25zdCBUYWJsZUNvbnRleHQgPSBjcmVhdGVDb250ZXh0KG51bGwpO1xuXG5jb25zdCBTb3J0RGlyZWN0aW9uID0gKHtkaXJlY3Rpb259KSA9PiAoXG4gIDxzdmdcbiAgICB3aWR0aD1cIjAuNWVtXCJcbiAgICBoZWlnaHQ9XCIwLjRlbVwiXG4gICAgdmlld0JveD1cIjAgMCAxIDFcIlxuICAgIHByZXNlcnZlQXNwZWN0UmF0aW89XCJub25lXCJcbiAgICB4bWxucz1cImh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnXCJcbiAgICB2ZXJzaW9uPVwiMS4xXCJcbiAgPlxuICAgIHtkaXJlY3Rpb24gPT09ICdhc2MnID8gPHBvbHlnb24gcG9pbnRzPVwiMC41LDAgMSwxIDAsMVwiIC8+IDogPHBvbHlnb24gcG9pbnRzPVwiMC41LDEgMCwwIDEsMFwiIC8+fVxuICA8L3N2Zz5cbik7XG5cbmNvbnN0IFRoZWFkID0gKCkgPT4ge1xuICBjb25zdCB7Y29sdW1ucywgaXRlbXMsIHNvcnRpbmcsIHNlbGVjdGlvbn0gPSBSZWFjdC51c2VDb250ZXh0KFRhYmxlQ29udGV4dCk7XG4gIGNvbnN0IGNvbCA9IGNvbHVtbnMuZmluZChjID0+IGMuZGVmYXVsdFNvcnQpO1xuICBjb25zdCBpbml0aWFsU29ydCA9IGNvbCAmJiB7Y29sdW1uOiBjb2wsIGRpcmVjdGlvbjogY29sLmRlZmF1bHRTb3J0fTtcbiAgY29uc3Qge2RpcmVjdGlvbiwgb25DbGljaywgaXNTb3J0ZWR9ID0gdXNlU29ydGluZyhpbml0aWFsU29ydCk7XG4gIHJldHVybiAoXG4gICAgPHRoZWFkPlxuICAgICAgPHRyPlxuICAgICAgICB7c2VsZWN0aW9uICYmIChcbiAgICAgICAgICA8VGg+XG4gICAgICAgICAgICA8RXpDaGVja2JveFxuICAgICAgICAgICAgICBsYWJlbD1cIlNlbGVjdCBhbGxcIlxuICAgICAgICAgICAgICBvbkNoYW5nZT17c2VsZWN0aW9uLm9uQnVsa1NlbGVjdENsaWNrfVxuICAgICAgICAgICAgICBjaGVja2VkPXtpdGVtcy5sZW5ndGggPT09IHNlbGVjdGlvbi5zZWxlY3RlZC5sZW5ndGh9XG4gICAgICAgICAgICAvPlxuICAgICAgICAgIDwvVGg+XG4gICAgICAgICl9XG4gICAgICAgIHtjb2x1bW5zLm1hcCgoY29sdW1uLCBjZWxsSW5kZXgpID0+IHtcbiAgICAgICAgICBjb25zdCB7c29ydGFibGUsIGhlYWRpbmcsIG51bWVyaWN9ID0gY29sdW1uO1xuICAgICAgICAgIHJldHVybiAoXG4gICAgICAgICAgICA8VGhcbiAgICAgICAgICAgICAga2V5PXtjb2x1bW4ua2V5IHx8IGNlbGxJbmRleH1cbiAgICAgICAgICAgICAgbnVtZXJpYz17bnVtZXJpY31cbiAgICAgICAgICAgICAgc29ydGFibGU9e3NvcnRhYmxlfVxuICAgICAgICAgICAgICBzb3J0ZWQ9e2lzU29ydGVkKGNvbHVtbil9XG4gICAgICAgICAgICAgIG9uQ2xpY2s9e2V2ZW50ID0+IG9uQ2xpY2soZXZlbnQsIGNvbHVtbiwgc29ydGluZy5vblNvcnRDbGljayl9XG4gICAgICAgICAgICA+XG4gICAgICAgICAgICAgIDxzcGFuPlxuICAgICAgICAgICAgICAgIHtoZWFkaW5nfSB7c29ydGFibGUgJiYgPFNvcnREaXJlY3Rpb24gZGlyZWN0aW9uPXtkaXJlY3Rpb259IC8+fVxuICAgICAgICAgICAgICA8L3NwYW4+XG4gICAgICAgICAgICA8L1RoPlxuICAgICAgICAgICk7XG4gICAgICAgIH0pfVxuICAgICAgPC90cj5cbiAgICAgIDxTZWxlY3Rpb25TdGF0ZUJhbm5lciAvPlxuICAgIDwvdGhlYWQ+XG4gICk7XG59O1xuXG5jb25zdCBTZWxlY3Rpb25TdGF0ZUJhbm5lciA9ICgpID0+IHtcbiAgY29uc3Qge3R9ID0gdXNlVHJhbnNsYXRpb24oZW4pO1xuICBjb25zdCB7Y29sdW1ucywgaXRlbXMsIHNlbGVjdGlvbiwgcGFnaW5hdGlvbn0gPSB1c2VDb250ZXh0KFRhYmxlQ29udGV4dCk7XG5cbiAgaWYgKCFzZWxlY3Rpb24gfHwgIXBhZ2luYXRpb24pIHJldHVybiBudWxsO1xuICBpZiAoIXNlbGVjdGlvbi5vblNlbGVjdEFsbENsaWNrKSByZXR1cm4gbnVsbDtcbiAgaWYgKHNlbGVjdGlvbi5zZWxlY3RlZC5sZW5ndGggIT09IGl0ZW1zLmxlbmd0aCAmJiAhc2VsZWN0aW9uLmFsbFNlbGVjdGVkKSByZXR1cm4gbnVsbDtcblxuICByZXR1cm4gKFxuICAgIDx0cj5cbiAgICAgIDx0ZCBjb2xTcGFuPXtjb2x1bW5zLmxlbmd0aCArIDF9PlxuICAgICAgICA8RXpMYXlvdXQgbGF5b3V0PVwiYmFzaWNcIj5cbiAgICAgICAgICB7c2VsZWN0aW9uLmFsbFNlbGVjdGVkIHx8IGl0ZW1zLmxlbmd0aCA9PT0gcGFnaW5hdGlvbi50b3RhbFJvd3MgPyAoXG4gICAgICAgICAgICA8c3Bhbj5cbiAgICAgICAgICAgICAge3QoJ0FsbCB7e3RvdGFsUm93Q291bnR9fSByb3dzIGFyZSBzZWxlY3RlZC4nLCB7XG4gICAgICAgICAgICAgICAgdG90YWxSb3dDb3VudDogcGFnaW5hdGlvbi50b3RhbFJvd3MsXG4gICAgICAgICAgICAgIH0pfVxuICAgICAgICAgICAgPC9zcGFuPlxuICAgICAgICAgICkgOiAoXG4gICAgICAgICAgICA8PlxuICAgICAgICAgICAgICA8c3Bhbj5cbiAgICAgICAgICAgICAgICB7dCgnQWxsIHt7c2VsZWN0ZWRDb3VudH19IHJvd3Mgb24gdGhpcyBwYWdlIGFyZSBzZWxlY3RlZC4nLCB7XG4gICAgICAgICAgICAgICAgICBzZWxlY3RlZENvdW50OiBzZWxlY3Rpb24uc2VsZWN0ZWQubGVuZ3RoLFxuICAgICAgICAgICAgICAgIH0pfVxuICAgICAgICAgICAgICA8L3NwYW4+XG4gICAgICAgICAgICAgIDxFekJ1dHRvblxuICAgICAgICAgICAgICAgIHVzZT1cInRlcnRpYXJ5XCJcbiAgICAgICAgICAgICAgICBvbkNsaWNrPXt3cmFwRXZlbnQoc2VsZWN0aW9uLm9uU2VsZWN0QWxsQ2xpY2ssICgpID0+XG4gICAgICAgICAgICAgICAgICBzZWxlY3Rpb24uc2V0QWxsU2VsZWN0ZWQodHJ1ZSlcbiAgICAgICAgICAgICAgICApfVxuICAgICAgICAgICAgICA+XG4gICAgICAgICAgICAgICAge3QoJ1NlbGVjdCBhbGwge3t0b3RhbFJvd0NvdW50fX0gcm93cycsIHtcbiAgICAgICAgICAgICAgICAgIHRvdGFsUm93Q291bnQ6IHBhZ2luYXRpb24udG90YWxSb3dzLFxuICAgICAgICAgICAgICAgIH0pfVxuICAgICAgICAgICAgICA8L0V6QnV0dG9uPlxuICAgICAgICAgICAgPC8+XG4gICAgICAgICAgKX1cbiAgICAgICAgICA8RXpCdXR0b24gdXNlPVwidGVydGlhcnlcIiBvbkNsaWNrPXtzZWxlY3Rpb24ub25TZWxlY3ROb25lQ2xpY2t9PlxuICAgICAgICAgICAge3QoJ0NsZWFyIHNlbGVjdGlvbicpfVxuICAgICAgICAgIDwvRXpCdXR0b24+XG4gICAgICAgIDwvRXpMYXlvdXQ+XG4gICAgICA8L3RkPlxuICAgIDwvdHI+XG4gICk7XG59O1xuXG5jb25zdCBUUm93ID0gKHtpdGVtfSkgPT4ge1xuICBjb25zdCB7Y29sdW1ucywgc2VsZWN0aW9ufSA9IHVzZUNvbnRleHQoVGFibGVDb250ZXh0KTtcbiAgY29uc3QgW3RhcmdldFJlZiwge3JlZiwgY2xpY2thYmxlLCBvbkNsaWNrLCBvbk1vdXNlRW50ZXJ9XSA9IHVzZUV4cGFuZGVkQ2xpY2tUYXJnZXQoKTtcblxuICByZXR1cm4gKFxuICAgIDxDbGlja2FibGVUciB7Li4ue3JlZjogcmVmIGFzIGFueSwgY2xpY2thYmxlLCBvbkNsaWNrLCBvbk1vdXNlRW50ZXJ9fT5cbiAgICAgIHtzZWxlY3Rpb24gJiYgKFxuICAgICAgICA8VGQ+XG4gICAgICAgICAgPEV6Q2hlY2tib3hcbiAgICAgICAgICAgIGxhYmVsPVwiU2VsZWN0IHJvd1wiXG4gICAgICAgICAgICBjaGVja2VkPXtzZWxlY3Rpb24uc2VsZWN0ZWQuaW5jbHVkZXMoaXRlbSl9XG4gICAgICAgICAgICBvbkNoYW5nZT17ZXZlbnQgPT4gc2VsZWN0aW9uLm9uUm93U2VsZWN0Q2xpY2soZXZlbnQsIHtpdGVtfSl9XG4gICAgICAgICAgLz5cbiAgICAgICAgPC9UZD5cbiAgICAgICl9XG4gICAgICB7Y29sdW1ucy5tYXAoKHtjb21wb25lbnQsIG51bWVyaWN9LCBjZWxsSW5kZXgpID0+IChcbiAgICAgICAgPFRkIGtleT17Y2VsbEluZGV4fSBudW1lcmljPXtudW1lcmljfT5cbiAgICAgICAgICB7Y3JlYXRlRWxlbWVudChjb21wb25lbnQsIHtpdGVtLCBsaW5rUmVmOiB0YXJnZXRSZWZ9KX1cbiAgICAgICAgPC9UZD5cbiAgICAgICkpfVxuICAgIDwvQ2xpY2thYmxlVHI+XG4gICk7XG59O1xuXG5jb25zdCBUYm9keSA9ICgpID0+IHtcbiAgY29uc3Qge2l0ZW1zfSA9IHVzZUNvbnRleHQoVGFibGVDb250ZXh0KTtcbiAgcmV0dXJuIChcbiAgICA8dGJvZHk+XG4gICAgICB7aXRlbXMubWFwKChpdGVtLCByb3dJbmRleCkgPT4gKFxuICAgICAgICA8VFJvdyBrZXk9e3Jvd0luZGV4fSBpdGVtPXtpdGVtfSAvPlxuICAgICAgKSl9XG4gICAgPC90Ym9keT5cbiAgKTtcbn07XG5cbmNvbnN0IFRhYmxlUGFnaW5hdGlvbiA9ICh7cGFnaW5hdGlvbn0pID0+IHtcbiAgY29uc3Qge3R9ID0gdXNlVHJhbnNsYXRpb24oZW4pO1xuICBjb25zdCBwYWdlcyA9IE1hdGguY2VpbChwYWdpbmF0aW9uLnRvdGFsUm93cyAvIHBhZ2luYXRpb24ucm93c1BlclBhZ2UpO1xuXG4gIHJldHVybiAoXG4gICAgPEV6Q2FyZEZvb3Rlcj5cbiAgICAgIDxFekxheW91dCBsYXlvdXQ9XCJzcGxpdFwiPlxuICAgICAgICA8VGFibGVQYWdpbmF0aW9uTmF2SXRlbXM+XG4gICAgICAgICAgPEV6QnV0dG9uXG4gICAgICAgICAgICB1c2U9XCJ0ZXJ0aWFyeVwiXG4gICAgICAgICAgICBvbkNsaWNrPXtwYWdpbmF0aW9uLm9uUHJldlBhZ2VDbGlja31cbiAgICAgICAgICAgIGRpc2FibGVkPXtwYWdpbmF0aW9uLmN1cnJlbnRQYWdlID09PSAxfVxuICAgICAgICAgID5cbiAgICAgICAgICAgIHsn4oC5ICd9XG4gICAgICAgICAgICB7dCgnUHJldmlvdXMgUGFnZScpfVxuICAgICAgICAgIDwvRXpCdXR0b24+XG4gICAgICAgICAgPHNwYW4+XG4gICAgICAgICAgICB7dCgnUGFnZSB7e2N1cnJlbnRQYWdlfX0gb2Yge3twYWdlc319Jywge2N1cnJlbnRQYWdlOiBwYWdpbmF0aW9uLmN1cnJlbnRQYWdlLCBwYWdlc30pfVxuICAgICAgICAgIDwvc3Bhbj5cbiAgICAgICAgICA8RXpCdXR0b25cbiAgICAgICAgICAgIHVzZT1cInRlcnRpYXJ5XCJcbiAgICAgICAgICAgIG9uQ2xpY2s9e3BhZ2luYXRpb24ub25OZXh0UGFnZUNsaWNrfVxuICAgICAgICAgICAgZGlzYWJsZWQ9e3BhZ2luYXRpb24uY3VycmVudFBhZ2UgPT09IHBhZ2VzfVxuICAgICAgICAgID5cbiAgICAgICAgICAgIHt0KCdOZXh0IFBhZ2UnKX1cbiAgICAgICAgICAgIHsnIOKAuid9XG4gICAgICAgICAgPC9FekJ1dHRvbj5cbiAgICAgICAgPC9UYWJsZVBhZ2luYXRpb25OYXZJdGVtcz5cbiAgICAgICAgPFRhYmxlUGFnaW5hdGlvblJvd0NvdW50RHJvcGRvd25cbiAgICAgICAgICBkZWZhdWx0VmFsdWU9e3BhZ2luYXRpb24ucm93c1BlclBhZ2V9XG4gICAgICAgICAgb25DaGFuZ2U9e3BhZ2luYXRpb24ub25Sb3dzUGVyUGFnZUNoYW5nZX1cbiAgICAgICAgPlxuICAgICAgICAgIHtwYWdpbmF0aW9uLnJvd3NQZXJQYWdlT3B0aW9ucy5tYXAodmFsdWUgPT4gKFxuICAgICAgICAgICAgPG9wdGlvbiBrZXk9e3ZhbHVlfSB2YWx1ZT17dmFsdWV9PlxuICAgICAgICAgICAgICB7dCgne3tudW19fSByb3dzIHBlciBwYWdlJywge251bTogdmFsdWV9KX1cbiAgICAgICAgICAgIDwvb3B0aW9uPlxuICAgICAgICAgICkpfVxuICAgICAgICA8L1RhYmxlUGFnaW5hdGlvblJvd0NvdW50RHJvcGRvd24+XG4gICAgICA8L0V6TGF5b3V0PlxuICAgIDwvRXpDYXJkRm9vdGVyPlxuICApO1xufTtcblxuLyoqXG4gKiBUYWJsZXMgZGlzcGxheSBpbmZvcm1hdGlvbiBpbiBhIHdheSB0aGF04oCZcyBlYXN5IHRvIHNjYW4sXG4gKiBzbyB0aGF0IHVzZXJzIGNhbiBsb29rIGZvciBwYXR0ZXJucyBhbmQgaW5zaWdodHMuXG4gKiBUaGV5IGNhbiBiZSBlbWJlZGRlZCBpbiBwcmltYXJ5IGNvbnRlbnQsIHN1Y2ggYXMgY2FyZHMuXG4gKi9cbmNvbnN0IEV6VGFibGU6IFJlYWN0LkZDPFRhYmxlUHJvcHM+ID0gKHtcbiAgYWN0aW9ucyxcbiAgdGl0bGUsXG4gIHN1YnRpdGxlLFxuICBjb2x1bW5zLFxuICBpdGVtcyxcbiAgc2VsZWN0aW9uLFxuICBvblNvcnRDbGljayxcbiAgcGFnaW5hdGlvbixcbn0pID0+IHtcbiAgY29uc3QgW2FsbFNlbGVjdGVkLCBzZXRBbGxTZWxlY3RlZF0gPSB1c2VTdGF0ZShmYWxzZSk7XG4gIGNvbnN0IHNlbGVjdGVkID0gc2VsZWN0aW9uICYmIGl0ZW1zLmZpbHRlcihzZWxlY3Rpb24uaXNSb3dTZWxlY3RlZCk7XG4gIGNvbnN0IG51bVNlbGVjdGVkT25QYWdlID0gc2VsZWN0ZWQgJiYgc2VsZWN0ZWQubGVuZ3RoO1xuICBjb25zdCB7Y3VycmVudFBhZ2UsIHJvd3NQZXJQYWdlfSA9IHBhZ2luYXRpb24gfHwgKHt9IGFzIGFueSk7XG4gIGNvbnN0IFt7eH0sIHNjcm9sbEV2ZW50c10gPSB1c2VTY3JvbGxQb3NpdGlvbigpO1xuICBjb25zdCBpc1Njcm9sbGluZyA9IHggPiAwO1xuICBjb25zdCBbaXNPdmVyZmxvd2luZywgb3ZlcmZsb3dEZXRlY3Rpb25dID0gdXNlT3ZlcmZsb3dEZXRlY3Rpb24oKTtcblxuICB1c2VFZmZlY3QoKCkgPT4gc2V0QWxsU2VsZWN0ZWQoZmFsc2UpLCBbbnVtU2VsZWN0ZWRPblBhZ2UsIGN1cnJlbnRQYWdlLCByb3dzUGVyUGFnZV0pO1xuXG4gIGNvbnN0IG1hcHBlZENvbHVtbnMgPSBjb2x1bW5zLm1hcChcbiAgICAoe1xuICAgICAgaGVhZGluZyxcbiAgICAgIGFjY2Vzc29yLFxuICAgICAga2V5ID0gdHlwZW9mIGFjY2Vzc29yID09PSAnc3RyaW5nJyA/IGFjY2Vzc29yIDogdW5kZWZpbmVkLFxuICAgICAgY29tcG9uZW50ID0gdHlwZW9mIGFjY2Vzc29yID09PSAnZnVuY3Rpb24nID8gYWNjZXNzb3IgOiAoe2l0ZW19OiBhbnkpID0+IDw+e2l0ZW1ba2V5XX08Lz4sXG4gICAgICBzb3J0YWJsZSxcbiAgICAgIC4uLnJlc3RcbiAgICB9KSA9PiAoe1xuICAgICAgaGVhZGluZyxcbiAgICAgIGtleSxcbiAgICAgIGNvbXBvbmVudCxcbiAgICAgIHNvcnRhYmxlLFxuICAgICAgLi4ucmVzdCxcbiAgICB9KVxuICApO1xuXG4gIGNvbnN0IHRhYmxlID0gKFxuICAgIDxUYWJsZUNvbnRleHQuUHJvdmlkZXJcbiAgICAgIHZhbHVlPXt7XG4gICAgICAgIGl0ZW1zLFxuICAgICAgICBzZWxlY3Rpb246IHNlbGVjdGlvbiAmJiB7XG4gICAgICAgICAgLi4uc2VsZWN0aW9uLFxuICAgICAgICAgIHNlbGVjdGVkLFxuICAgICAgICAgIGFsbFNlbGVjdGVkLFxuICAgICAgICAgIHNldEFsbFNlbGVjdGVkLFxuICAgICAgICB9LFxuICAgICAgICBjb2x1bW5zOiBtYXBwZWRDb2x1bW5zLFxuICAgICAgICBwYWdpbmF0aW9uLFxuICAgICAgICBzb3J0aW5nOiB7b25Tb3J0Q2xpY2t9LFxuICAgICAgfX1cbiAgICA+XG4gICAgICA8Q29udGFpbmVyXG4gICAgICAgIGNvbHM9e2NvbHVtbnMubGVuZ3RofVxuICAgICAgICBzZWxlY3RhYmxlPXshIXNlbGVjdGlvbn1cbiAgICAgICAgb3ZlcmZsb3dpbmc9e2lzT3ZlcmZsb3dpbmd9XG4gICAgICAgIGlzU2Nyb2xsaW5nPXtpc1Njcm9sbGluZ31cbiAgICAgICAgey4uLnNjcm9sbEV2ZW50c31cbiAgICAgICAgcmVmPXtvdmVyZmxvd0RldGVjdGlvbi5yZWZ9XG4gICAgICA+XG4gICAgICAgIDxUYWJsZSBzZWxlY3RhYmxlPXshIXNlbGVjdGlvbn0gdXNlPXshdGl0bGUgPyAnc2ltcGxlJyA6ICdmdWxsJ30+XG4gICAgICAgICAgPFRoZWFkIC8+XG4gICAgICAgICAgPFRib2R5IC8+XG4gICAgICAgIDwvVGFibGU+XG4gICAgICA8L0NvbnRhaW5lcj5cbiAgICA8L1RhYmxlQ29udGV4dC5Qcm92aWRlcj5cbiAgKTtcblxuICBpZiAoIXRpdGxlKSByZXR1cm4gdGFibGU7XG5cbiAgcmV0dXJuIChcbiAgICA8RXpDYXJkIHRpdGxlPXt0aXRsZX0gc3VidGl0bGU9e3N1YnRpdGxlfSBhY3Rpb25zPXthY3Rpb25zfT5cbiAgICAgIDxUYWJsZUNhcmRTZWN0aW9uPnt0YWJsZX08L1RhYmxlQ2FyZFNlY3Rpb24+XG4gICAgICB7cGFnaW5hdGlvbiAmJiA8VGFibGVQYWdpbmF0aW9uIHBhZ2luYXRpb249e3BhZ2luYXRpb259IC8+fVxuICAgIDwvRXpDYXJkPlxuICApO1xufTtcblxuZXhwb3J0IGRlZmF1bHQgRXpUYWJsZTtcbiJdfQ==